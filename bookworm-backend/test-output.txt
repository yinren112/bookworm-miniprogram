
> bookworm-backend@1.0.0 test:integration
> dotenv -e .env.test -- vitest run --config vitest.integration.config.ts


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/wapadil/WeChatProjects/miniprogram-13/bookworm-backend[39m

[Worker 1] Starting a dedicated PostgreSQL container...
[Worker 1] Container started. Applying migrations...
[Worker 1] Migrations applied.
[90mstdout[2m | src/tests/order-status-management.integration.test.ts[2m > [22m[2mOrder Status Management Integration Tests
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

[90mstderr[2m | src/tests/order-status-management.integration.test.ts[2m > [22m[2mOrder Status Management Integration Tests
[22m[39m‚úÖ Test database URL set for worker 1: postgres://test:test@localhost...

Sourcemap for "C:/Users/wapadil/WeChatProjects/miniprogram-13/bookworm-backend/node_modules/node-cron/dist/esm/node-cron.js" points to missing source files
[90mstderr[2m | src/tests/order-status-management.integration.test.ts[2m > [22m[2mOrder Status Management Integration Tests
[22m[39m!!! WARNING: Failed to initialize WeChat Pay SDK. Payment features will be disabled. Reason: WeChat Pay configuration is incomplete or certificate files are missing.

[90mstderr[2m | src/tests/order-status-management.integration.test.ts[2m > [22m[2mOrder Status Management Integration Tests
[22m[39mMetrics endpoint registered at /metrics

{"level":30,"time":1760782601476,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:8534","remoteAddress":"::ffff:127.0.0.1","remotePort":8535},"msg":"incoming request"}
{"level":30,"time":1760782601567,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","res":{"statusCode":201},"responseTime":89.89779999991879,"msg":"request completed"}
{"level":30,"time":1760782601586,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:8537","remoteAddress":"::ffff:127.0.0.1","remotePort":8538},"msg":"incoming request"}
{"level":30,"time":1760782601591,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782601614,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","res":{"statusCode":200},"responseTime":28.39229999994859,"msg":"request completed"}
{"level":30,"time":1760782602441,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-3","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:11514","remoteAddress":"::ffff:127.0.0.1","remotePort":11515},"msg":"incoming request"}
{"level":30,"time":1760782602490,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-3","res":{"statusCode":201},"responseTime":48.25799999991432,"msg":"request completed"}
{"level":30,"time":1760782602504,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:11518","remoteAddress":"::ffff:127.0.0.1","remotePort":11519},"msg":"incoming request"}
{"level":30,"time":1760782602510,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782602560,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","res":{"statusCode":200},"responseTime":55.083300000056624,"msg":"request completed"}
{"level":30,"time":1760782603265,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-5","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:11522","remoteAddress":"::ffff:127.0.0.1","remotePort":11523},"msg":"incoming request"}
{"level":30,"time":1760782603310,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-5","res":{"statusCode":201},"responseTime":44.539900000207126,"msg":"request completed"}
{"level":30,"time":1760782603329,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-6","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:11524","remoteAddress":"::ffff:127.0.0.1","remotePort":11525},"msg":"incoming request"}
{"level":30,"time":1760782603332,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782603347,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-6","res":{"statusCode":200},"responseTime":17.90639999974519,"msg":"request completed"}
{"level":30,"time":1760782604041,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-7","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:12487","remoteAddress":"::ffff:127.0.0.1","remotePort":12498},"msg":"incoming request"}
{"level":30,"time":1760782604073,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-7","res":{"statusCode":201},"responseTime":31.91009999997914,"msg":"request completed"}
{"level":30,"time":1760782604091,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-8","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:12499","remoteAddress":"::ffff:127.0.0.1","remotePort":12500},"msg":"incoming request"}
{"level":30,"time":1760782604093,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":50,"time":1760782604100,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-8","err":{"type":"ApiError","message":"Êó†Ê≥ïÂ∞ÜËÆ¢Âçï‰ªé PENDING_PAYMENT Êõ¥Êñ∞‰∏∫ COMPLETED","stack":"ApiError: Êó†Ê≥ïÂ∞ÜËÆ¢Âçï‰ªé PENDING_PAYMENT Êõ¥Êñ∞‰∏∫ COMPLETED\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:80:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":400,"code":"INVALID_STATUS_TRANSITION"},"req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:12499","remoteAddress":"::ffff:127.0.0.1","remotePort":12500},"msg":"An error occurred during the request"}
{"level":30,"time":1760782604131,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-8","res":{"statusCode":400},"responseTime":39.89509999984875,"msg":"request completed"}
{"level":30,"time":1760782604896,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-9","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:12503","remoteAddress":"::ffff:127.0.0.1","remotePort":12504},"msg":"incoming request"}
{"level":30,"time":1760782604931,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-9","res":{"statusCode":201},"responseTime":35.24000000022352,"msg":"request completed"}
{"level":30,"time":1760782604952,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-a","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:12505","remoteAddress":"::ffff:127.0.0.1","remotePort":12506},"msg":"incoming request"}
{"level":30,"time":1760782604958,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":50,"time":1760782604969,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-a","err":{"type":"ApiError","message":"Êó†Ê≥ïÂ∞ÜËÆ¢Âçï‰ªé COMPLETED Êõ¥Êñ∞‰∏∫ CANCELLED","stack":"ApiError: Êó†Ê≥ïÂ∞ÜËÆ¢Âçï‰ªé COMPLETED Êõ¥Êñ∞‰∏∫ CANCELLED\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:80:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":400,"code":"INVALID_STATUS_TRANSITION"},"req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:12505","remoteAddress":"::ffff:127.0.0.1","remotePort":12506},"msg":"An error occurred during the request"}
{"level":30,"time":1760782604970,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-a","res":{"statusCode":400},"responseTime":18.43100000033155,"msg":"request completed"}
{"level":30,"time":1760782605712,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-b","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:12509","remoteAddress":"::ffff:127.0.0.1","remotePort":12510},"msg":"incoming request"}
{"level":30,"time":1760782605779,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-b","res":{"statusCode":201},"responseTime":66.64449999993667,"msg":"request completed"}
{"level":30,"time":1760782605802,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-c","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:12511","remoteAddress":"::ffff:127.0.0.1","remotePort":12512},"msg":"incoming request"}
{"level":30,"time":1760782605805,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":50,"time":1760782605812,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-c","err":{"type":"ApiError","message":"Êó†Ê≥ïÂ∞ÜËÆ¢Âçï‰ªé CANCELLED Êõ¥Êñ∞‰∏∫ COMPLETED","stack":"ApiError: Êó†Ê≥ïÂ∞ÜËÆ¢Âçï‰ªé CANCELLED Êõ¥Êñ∞‰∏∫ COMPLETED\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:80:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":400,"code":"INVALID_STATUS_TRANSITION"},"req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:12511","remoteAddress":"::ffff:127.0.0.1","remotePort":12512},"msg":"An error occurred during the request"}
{"level":30,"time":1760782605813,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-c","res":{"statusCode":400},"responseTime":11.079800000414252,"msg":"request completed"}
{"level":30,"time":1760782606513,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-d","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:12484","remoteAddress":"::ffff:127.0.0.1","remotePort":12498},"msg":"incoming request"}
{"level":30,"time":1760782606538,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-d","res":{"statusCode":201},"responseTime":25.722099999897182,"msg":"request completed"}
{"level":30,"time":1760782606547,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-e","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:12500","remoteAddress":"::ffff:127.0.0.1","remotePort":12504},"msg":"incoming request"}
{"level":30,"time":1760782606549,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-e","res":{"statusCode":403},"responseTime":1.9937999998219311,"msg":"request completed"}
{"level":30,"time":1760782607269,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-f","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:12513","remoteAddress":"::ffff:127.0.0.1","remotePort":12514},"msg":"incoming request"}
{"level":30,"time":1760782607295,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-f","res":{"statusCode":201},"responseTime":26.27240000013262,"msg":"request completed"}
{"level":30,"time":1760782607303,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-g","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:12515","remoteAddress":"::ffff:127.0.0.1","remotePort":12516},"msg":"incoming request"}
{"level":30,"time":1760782607304,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-g","res":{"statusCode":401},"responseTime":0.35759999975562096,"msg":"request completed"}
{"level":30,"time":1760782607966,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-h","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:12519","remoteAddress":"::ffff:127.0.0.1","remotePort":12520},"msg":"incoming request"}
{"level":30,"time":1760782607995,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-h","res":{"statusCode":201},"responseTime":28.695899999700487,"msg":"request completed"}
{"level":30,"time":1760782608008,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-i","req":{"method":"PATCH","url":"/api/orders/99999/status","hostname":"127.0.0.1:12521","remoteAddress":"::ffff:127.0.0.1","remotePort":12522},"msg":"incoming request"}
{"level":30,"time":1760782608012,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":50,"time":1760782608018,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-i","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/99999/status","hostname":"127.0.0.1:12521","remoteAddress":"::ffff:127.0.0.1","remotePort":12522},"msg":"An error occurred during the request"}
{"level":30,"time":1760782608019,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-i","res":{"statusCode":404},"responseTime":10.729499999899417,"msg":"request completed"}
{"level":30,"time":1760782608672,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-j","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:12527","remoteAddress":"::ffff:127.0.0.1","remotePort":12528},"msg":"incoming request"}
{"level":30,"time":1760782608709,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-j","res":{"statusCode":201},"responseTime":36.58449999988079,"msg":"request completed"}
{"level":30,"time":1760782608716,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-k","req":{"method":"PATCH","url":"/api/orders/invalid-id/status","hostname":"127.0.0.1:12529","remoteAddress":"::ffff:127.0.0.1","remotePort":12530},"msg":"incoming request"}
{"level":50,"time":1760782608717,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-k","err":{"type":"Error","message":"params/id must be number","stack":"Error: params/id must be number\n    at defaultSchemaErrorFormatter (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\context.js:114:10)\n    at wrapValidationError (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\validation.js:249:17)\n    at validate (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\validation.js:145:16)\n    at preValidationCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:93:25)\n    at handler (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:77:7)\n    at C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at done (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:304:5)\n    at IncomingMessage.onEnd (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:283:27)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"/id","schemaPath":"#/properties/id/type","keyword":"type","params":{"type":"number"},"message":"must be number"}],"validationContext":"params"},"req":{"method":"PATCH","url":"/api/orders/invalid-id/status","hostname":"127.0.0.1:12529","remoteAddress":"::ffff:127.0.0.1","remotePort":12530},"msg":"An error occurred during the request"}
{"level":30,"time":1760782608718,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-k","res":{"statusCode":400},"responseTime":2.186699999962002,"msg":"request completed"}
{"level":30,"time":1760782609414,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-l","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:13041","remoteAddress":"::ffff:127.0.0.1","remotePort":13042},"msg":"incoming request"}
{"level":30,"time":1760782609457,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-l","res":{"statusCode":201},"responseTime":42.49899999983609,"msg":"request completed"}
{"level":30,"time":1760782609466,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-m","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:13043","remoteAddress":"::ffff:127.0.0.1","remotePort":13044},"msg":"incoming request"}
{"level":50,"time":1760782609467,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-m","err":{"type":"Error","message":"body/status must be equal to constant, body/status must be equal to constant, body/status must match a schema in anyOf","stack":"Error: body/status must be equal to constant, body/status must be equal to constant, body/status must match a schema in anyOf\n    at defaultSchemaErrorFormatter (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\context.js:114:10)\n    at wrapValidationError (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\validation.js:249:17)\n    at validate (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\validation.js:167:16)\n    at preValidationCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:93:25)\n    at handler (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:77:7)\n    at C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at done (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:304:5)\n    at IncomingMessage.onEnd (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:283:27)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"/status","schemaPath":"#/properties/status/anyOf/0/const","keyword":"const","params":{"allowedValue":"COMPLETED"},"message":"must be equal to constant"},{"instancePath":"/status","schemaPath":"#/properties/status/anyOf/1/const","keyword":"const","params":{"allowedValue":"CANCELLED"},"message":"must be equal to constant"},{"instancePath":"/status","schemaPath":"#/properties/status/anyOf","keyword":"anyOf","params":{},"message":"must match a schema in anyOf"}],"validationContext":"body"},"req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:13043","remoteAddress":"::ffff:127.0.0.1","remotePort":13044},"msg":"An error occurred during the request"}
{"level":30,"time":1760782609467,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-m","res":{"statusCode":400},"responseTime":1.0696000000461936,"msg":"request completed"}
{"level":30,"time":1760782610141,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-n","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:13045","remoteAddress":"::ffff:127.0.0.1","remotePort":13046},"msg":"incoming request"}
{"level":30,"time":1760782610170,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-n","res":{"statusCode":201},"responseTime":29.11629999987781,"msg":"request completed"}
{"level":30,"time":1760782610179,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-o","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:13047","remoteAddress":"::ffff:127.0.0.1","remotePort":13048},"msg":"incoming request"}
{"level":50,"time":1760782610180,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-o","err":{"type":"Error","message":"body must have required property 'status'","stack":"Error: body must have required property 'status'\n    at defaultSchemaErrorFormatter (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\context.js:114:10)\n    at wrapValidationError (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\validation.js:249:17)\n    at validate (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\validation.js:167:16)\n    at preValidationCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:93:25)\n    at handler (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:77:7)\n    at C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at done (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:304:5)\n    at IncomingMessage.onEnd (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:283:27)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"","schemaPath":"#/required","keyword":"required","params":{"missingProperty":"status"},"message":"must have required property 'status'"}],"validationContext":"body"},"req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:13047","remoteAddress":"::ffff:127.0.0.1","remotePort":13048},"msg":"An error occurred during the request"}
{"level":30,"time":1760782610180,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-o","res":{"statusCode":400},"responseTime":1.1809999998658895,"msg":"request completed"}
{"level":30,"time":1760782610849,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-p","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:13049","remoteAddress":"::ffff:127.0.0.1","remotePort":13050},"msg":"incoming request"}
{"level":30,"time":1760782610880,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-p","res":{"statusCode":201},"responseTime":31.438300000037998,"msg":"request completed"}
{"level":30,"time":1760782610890,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-q","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:13051","remoteAddress":"::ffff:127.0.0.1","remotePort":13052},"msg":"incoming request"}
{"level":30,"time":1760782610893,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782610907,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-q","res":{"statusCode":200},"responseTime":17.10300000011921,"msg":"request completed"}
{"level":30,"time":1760782611531,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-r","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:7052","remoteAddress":"::ffff:127.0.0.1","remotePort":7053},"msg":"incoming request"}
{"level":30,"time":1760782611558,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-r","res":{"statusCode":201},"responseTime":26.560599999967963,"msg":"request completed"}
{"level":30,"time":1760782611576,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-s","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:7054","remoteAddress":"::ffff:127.0.0.1","remotePort":7056},"msg":"incoming request"}
{"level":30,"time":1760782611577,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-t","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:7054","remoteAddress":"::ffff:127.0.0.1","remotePort":7063},"msg":"incoming request"}
{"level":30,"time":1760782611577,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-u","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:7054","remoteAddress":"::ffff:127.0.0.1","remotePort":7064},"msg":"incoming request"}
{"level":30,"time":1760782611577,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-v","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:7054","remoteAddress":"::ffff:127.0.0.1","remotePort":7055},"msg":"incoming request"}
{"level":30,"time":1760782611578,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-w","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:7054","remoteAddress":"::ffff:127.0.0.1","remotePort":7057},"msg":"incoming request"}
{"level":30,"time":1760782611578,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-x","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:7054","remoteAddress":"::ffff:127.0.0.1","remotePort":7058},"msg":"incoming request"}
{"level":30,"time":1760782611578,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-y","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:7054","remoteAddress":"::ffff:127.0.0.1","remotePort":7059},"msg":"incoming request"}
{"level":30,"time":1760782611579,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-z","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:7054","remoteAddress":"::ffff:127.0.0.1","remotePort":7060},"msg":"incoming request"}
{"level":30,"time":1760782611579,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-10","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:7054","remoteAddress":"::ffff:127.0.0.1","remotePort":7061},"msg":"incoming request"}
{"level":30,"time":1760782611580,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-11","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:7054","remoteAddress":"::ffff:127.0.0.1","remotePort":7062},"msg":"incoming request"}
{"level":30,"time":1760782611581,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782611582,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782611582,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782611593,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782611597,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782611597,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782611598,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782611599,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782611601,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782611609,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-x","res":{"statusCode":200},"responseTime":30.454200000036508,"msg":"request completed"}
{"level":30,"time":1760782611613,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":50,"time":1760782611622,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-u","err":{"type":"ApiError","message":"Êó†Ê≥ïÂ∞ÜËÆ¢Âçï‰ªé CANCELLED Êõ¥Êñ∞‰∏∫ CANCELLED","stack":"ApiError: Êó†Ê≥ïÂ∞ÜËÆ¢Âçï‰ªé CANCELLED Êõ¥Êñ∞‰∏∫ CANCELLED\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:80:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":400,"code":"INVALID_STATUS_TRANSITION"},"req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:7054","remoteAddress":"::ffff:127.0.0.1","remotePort":7064},"msg":"An error occurred during the request"}
{"level":30,"time":1760782611622,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-u","res":{"statusCode":400},"responseTime":45.17189999995753,"msg":"request completed"}
{"level":30,"time":1760782611624,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-t","res":{"statusCode":200},"responseTime":47.776199999731034,"msg":"request completed"}
{"level":30,"time":1760782611639,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-w","res":{"statusCode":200},"responseTime":61.61679999995977,"msg":"request completed"}
{"level":30,"time":1760782611655,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-10","res":{"statusCode":200},"responseTime":75.5820999997668,"msg":"request completed"}
{"level":30,"time":1760782611668,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-s","res":{"statusCode":200},"responseTime":91.95099999988452,"msg":"request completed"}
{"level":30,"time":1760782611682,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-v","res":{"statusCode":200},"responseTime":104.79480000026524,"msg":"request completed"}
{"level":30,"time":1760782611697,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-y","res":{"statusCode":200},"responseTime":118.43980000028387,"msg":"request completed"}
{"level":30,"time":1760782611709,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-z","res":{"statusCode":200},"responseTime":129.75979999965057,"msg":"request completed"}
{"level":30,"time":1760782611721,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-11","res":{"statusCode":200},"responseTime":141.18009999999776,"msg":"request completed"}
 [32m‚úì[39m src/tests/order-status-management.integration.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 13071[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Status Management Integration Tests[2m > [22mSTAFF Order Status Updates[2m > [22mshould allow STAFF to complete a PENDING_PICKUP order [33m 970[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Status Management Integration Tests[2m > [22mSTAFF Order Status Updates[2m > [22mshould allow STAFF to cancel a PENDING_PICKUP order [33m 938[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Status Management Integration Tests[2m > [22mSTAFF Order Status Updates[2m > [22mshould allow STAFF to cancel a PENDING_PAYMENT order [33m 766[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Status Management Integration Tests[2m > [22mSTAFF Order Status Updates[2m > [22mshould reject invalid status transitions [33m 783[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Status Management Integration Tests[2m > [22mSTAFF Order Status Updates[2m > [22mshould reject attempts to change status of already COMPLETED orders [33m 845[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Status Management Integration Tests[2m > [22mSTAFF Order Status Updates[2m > [22mshould reject attempts to change status of already CANCELLED orders [33m 845[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Status Management Integration Tests[2m > [22mAccess Control[2m > [22mshould reject regular USER attempts to update order status [33m 753[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Status Management Integration Tests[2m > [22mAccess Control[2m > [22mshould reject unauthenticated requests [33m 720[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Status Management Integration Tests[2m > [22mAccess Control[2m > [22mshould handle non-existent order IDs [33m 692[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Status Management Integration Tests[2m > [22mAccess Control[2m > [22mshould handle invalid order IDs [33m 709[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Status Management Integration Tests[2m > [22mRequest Validation[2m > [22mshould reject invalid status values [33m 772[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Status Management Integration Tests[2m > [22mRequest Validation[2m > [22mshould reject missing status field [33m 696[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Status Management Integration Tests[2m > [22mRequest Validation[2m > [22mshould reject requests with extra fields [33m 706[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Status Management Integration Tests[2m > [22mRate Limiting[2m > [22mshould handle rapid requests gracefully when rate limiting is disabled [33m 839[2mms[22m[39m
[90mstdout[2m | src/tests/concurrent-order-control.integration.test.ts[2m > [22m[2mConcurrent Order Control Integration Tests
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

 [32m‚úì[39m src/tests/concurrent-order-control.integration.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 10871[2mms[22m[39m
   [33m[2m‚úì[22m[39m Concurrent Order Control Integration Tests[2m > [22mÊï∞ÊçÆÂ∫ìÂ±ÇÈù¢ÔºöÈÉ®ÂàÜÂîØ‰∏ÄÁ¥¢ÂºïËßÑÂàô[2m > [22mÂ∫îËØ•Èò≤Ê≠¢Âêå‰∏ÄÁî®Êà∑ÂàõÂª∫Â§ö‰∏™PENDING_PAYMENTËÆ¢Âçï [33m 851[2mms[22m[39m
   [33m[2m‚úì[22m[39m Concurrent Order Control Integration Tests[2m > [22mÊï∞ÊçÆÂ∫ìÂ±ÇÈù¢ÔºöÈÉ®ÂàÜÂîØ‰∏ÄÁ¥¢ÂºïËßÑÂàô[2m > [22mÂ∫îËØ•ÂÖÅËÆ∏‰∏çÂêåÁî®Êà∑ÂêåÊó∂ÂàõÂª∫PENDING_PAYMENTËÆ¢Âçï [33m 763[2mms[22m[39m
   [33m[2m‚úì[22m[39m Concurrent Order Control Integration Tests[2m > [22mÊï∞ÊçÆÂ∫ìÂ±ÇÈù¢ÔºöÈÉ®ÂàÜÂîØ‰∏ÄÁ¥¢ÂºïËßÑÂàô[2m > [22mÂπ∂ÂèëÁ´û‰∫âÂêå‰∏ÄÂ∫ìÂ≠òÊó∂Â∫î‰ªÖ‰∏ÄÁ¨îÊàêÂäü [33m 867[2mms[22m[39m
   [33m[2m‚úì[22m[39m Concurrent Order Control Integration Tests[2m > [22mÊï∞ÊçÆÂ∫ìÂ±ÇÈù¢ÔºöÈÉ®ÂàÜÂîØ‰∏ÄÁ¥¢ÂºïËßÑÂàô[2m > [22mÁî®Êà∑ËÆ¢ÂçïÁä∂ÊÄÅÂèòÂåñÂêéÂ∫îËØ•ËÉΩÂàõÂª∫Êñ∞ËÆ¢Âçï [33m 728[2mms[22m[39m
   [33m[2m‚úì[22m[39m Concurrent Order Control Integration Tests[2m > [22mÂ∫îÁî®Â±ÇÈù¢ÔºöÊÄªÂ∫ìÂ≠ò‰∏äÈôêÊ£ÄÊü•[2m > [22mÂ∫îËØ•Èò≤Ê≠¢Áî®Êà∑È¢ÑÁïôË∂ÖËøá‰∏äÈôêÁöÑÂïÜÂìÅÊÄªÊï∞ [33m 719[2mms[22m[39m
   [33m[2m‚úì[22m[39m Concurrent Order Control Integration Tests[2m > [22mÂ∫îÁî®Â±ÇÈù¢ÔºöÊÄªÂ∫ìÂ≠ò‰∏äÈôêÊ£ÄÊü•[2m > [22mÂ∫îËØ•ÈÄöËøáÈÉ®ÂàÜÂîØ‰∏ÄÁ¥¢ÂºïÈò≤Ê≠¢Áî®Êà∑ÂàõÂª∫Â§ö‰∏™pendingËÆ¢Âçï [33m 727[2mms[22m[39m
   [33m[2m‚úì[22m[39m Concurrent Order Control Integration Tests[2m > [22mÂ∫îÁî®Â±ÇÈù¢ÔºöÊÄªÂ∫ìÂ≠ò‰∏äÈôêÊ£ÄÊü•[2m > [22mÂ∫îËØ•ÈÄöËøáÊ®°ÊãüÊï∞ÊçÆÊµãËØïMAX_RESERVED_ITEMS_PER_USERÈÄªËæë [33m 768[2mms[22m[39m
   [33m[2m‚úì[22m[39m Concurrent Order Control Integration Tests[2m > [22mÂ∫îÁî®Â±ÇÈù¢ÔºöÊÄªÂ∫ìÂ≠ò‰∏äÈôêÊ£ÄÊü•[2m > [22mÂ∫îËØ•ÂÖÅËÆ∏Âú®ÂçïÁ¨îËÆ¢Âçï‰∏äÈôêÂÜÖÂàõÂª∫ËÆ¢Âçï [33m 900[2mms[22m[39m
   [33m[2m‚úì[22m[39m Concurrent Order Control Integration Tests[2m > [22mÂ∫îÁî®Â±ÇÈù¢ÔºöÊÄªÂ∫ìÂ≠ò‰∏äÈôêÊ£ÄÊü•[2m > [22mÂ∫îËØ•ÂÖÅËÆ∏Âú®ÊÄªÈ¢ÑÁïô‰∏äÈôêÂÜÖÂàõÂª∫Â§ö‰∏™ËÆ¢Âçï [33m 845[2mms[22m[39m
   [33m[2m‚úì[22m[39m Concurrent Order Control Integration Tests[2m > [22mÂèåÈáç‰øùÊä§Êú∫Âà∂ÂçèÂêåÂ∑•‰Ωú[2m > [22m‰∏§‰∏™ËßÑÂàôÂ∫îËØ•Áã¨Á´ãÂ∑•‰ΩúÔºå‰∏ç‰∫íÁõ∏Âπ≤Êâ∞ [33m 960[2mms[22m[39m
   [33m[2m‚úì[22m[39m Concurrent Order Control Integration Tests[2m > [22mÊï∞ÊçÆÂ∫ìÈò≤Á∫ø[2m > [22mË∂ÖÂá∫Êï∞ÊçÆÂ∫ìÈ¢ÑÁïô‰∏äÈôêÊó∂Â∫îÁõ¥Êé•ÊãíÁªù [33m 927[2mms[22m[39m
   [33m[2m‚úì[22m[39m Concurrent Order Control Integration Tests[2m > [22mËæπÁïåÊÉÖÂÜµÊµãËØï[2m > [22mÂ∫îËØ•Ê≠£Á°ÆÂ§ÑÁêÜÁ©∫ÂïÜÂìÅÂàóË°® [33m 586[2mms[22m[39m
   [33m[2m‚úì[22m[39m Concurrent Order Control Integration Tests[2m > [22mËæπÁïåÊÉÖÂÜµÊµãËØï[2m > [22mÂ∫îËØ•Ê≠£Á°ÆÂ§ÑÁêÜ‰∏çÂ≠òÂú®ÁöÑÂïÜÂìÅID [33m 583[2mms[22m[39m
   [33m[2m‚úì[22m[39m Concurrent Order Control Integration Tests[2m > [22mËæπÁïåÊÉÖÂÜµÊµãËØï[2m > [22mÂ∫îËØ•Ê≠£Á°ÆÂ§ÑÁêÜÈÉ®ÂàÜÊó†ÊïàÁöÑÂïÜÂìÅID [33m 639[2mms[22m[39m
[90mstdout[2m | src/tests/user-merge.integration.test.ts[2m > [22m[2mUser Account Merge
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

[90mstdout[2m | src/tests/user-merge.integration.test.ts[2m > [22m[2mUser Account Merge[2m > [22m[2mshould merge PRE_REGISTERED user with WeChat account when phone numbers match
[22m[39m[MERGE] PRE_REGISTERED user 1 upgraded to REGISTERED with openid wx_rea***

[90mstdout[2m | src/tests/user-merge.integration.test.ts[2m > [22m[2mUser Account Merge[2m > [22m[2mshould preserve unionid during merge
[22m[39m[MERGE] PRE_REGISTERED user 1 upgraded to REGISTERED with openid wx_ope***

[90mstdout[2m | src/tests/user-merge.integration.test.ts[2m > [22m[2mUser Account Merge[2m > [22m[2mshould handle CONFLICT: openid already used by REGISTERED user
[22m[39m[MERGE CONFLICT] PRE_REGISTERED user 2 (phone=135****5555) conflicts with existing REGISTERED user 1 (openid=wx_con***). Merging into REGISTERED user.

[90mstdout[2m | src/tests/user-merge.integration.test.ts[2m > [22m[2mUser Account Merge[2m > [22m[2mshould handle CONFLICT: openid already used by REGISTERED user
[22m[39m[MERGE COMPLETE] Transferred data from PRE_REGISTERED user 2 to REGISTERED user 1 and deleted placeholder.

[90mstdout[2m | src/tests/user-merge.integration.test.ts[2m > [22m[2mUser Account Merge[2m > [22m[2mshould transfer ALL associated records during CONFLICT merge
[22m[39m[MERGE CONFLICT] PRE_REGISTERED user 2 (phone=133****3333) conflicts with existing REGISTERED user 1 (openid=wx_ful***). Merging into REGISTERED user.

[90mstdout[2m | src/tests/user-merge.integration.test.ts[2m > [22m[2mUser Account Merge[2m > [22m[2mshould transfer ALL associated records during CONFLICT merge
[22m[39m[MERGE COMPLETE] Transferred data from PRE_REGISTERED user 2 to REGISTERED user 1 and deleted placeholder.

[90mstdout[2m | src/tests/user-merge.integration.test.ts[2m > [22m[2mUser Account Merge[2m > [22m[2mshould handle CONFLICT: both phone and openid already used by REGISTERED user
[22m[39m[MERGE CONFLICT] PRE_REGISTERED user 2 (phone=134****4444) conflicts with existing REGISTERED user 1 (openid=wx_dou***). Merging into REGISTERED user.

[90mstdout[2m | src/tests/user-merge.integration.test.ts[2m > [22m[2mUser Account Merge[2m > [22m[2mshould handle CONFLICT: both phone and openid already used by REGISTERED user
[22m[39m[MERGE COMPLETE] Transferred data from PRE_REGISTERED user 2 to REGISTERED user 1 and deleted placeholder.

 [32m‚úì[39m src/tests/user-merge.integration.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 5065[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Account Merge[2m > [22mshould merge PRE_REGISTERED user with WeChat account when phone numbers match [33m 653[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Account Merge[2m > [22mshould create new user when phone number doesn't match any PRE_REGISTERED account [33m 589[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Account Merge[2m > [22mshould not merge if existing account has same openid but different phone [33m 585[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Account Merge[2m > [22mshould handle login without phone authorization (legacy flow) [33m 633[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Account Merge[2m > [22mshould preserve unionid during merge [33m 617[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Account Merge[2m > [22mshould handle CONFLICT: openid already used by REGISTERED user [33m 653[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Account Merge[2m > [22mshould transfer ALL associated records during CONFLICT merge [33m 693[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Account Merge[2m > [22mshould handle CONFLICT: both phone and openid already used by REGISTERED user [33m 630[2mms[22m[39m
[90mstdout[2m | src/tests/inventoryService.integration.test.ts[2m > [22m[2mInventory Service Integration Tests
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

 [32m‚úì[39m src/tests/inventoryService.integration.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 5468[2mms[22m[39m
   [33m[2m‚úì[22m[39m Inventory Service Integration Tests[2m > [22maddBookToInventory[2m > [22mshould create a new bookMaster, sku, and inventory item for a new ISBN [33m 656[2mms[22m[39m
   [33m[2m‚úì[22m[39m Inventory Service Integration Tests[2m > [22maddBookToInventory[2m > [22mshould create only a new inventory item for an existing book SKU [33m 660[2mms[22m[39m
   [33m[2m‚úì[22m[39m Inventory Service Integration Tests[2m > [22mfulfillOrder[2m > [22mshould complete the order and mark inventory as sold with a valid pickup code [33m 773[2mms[22m[39m
   [33m[2m‚úì[22m[39m Inventory Service Integration Tests[2m > [22mfulfillOrder[2m > [22mshould throw an error for an invalid pickup code [33m 639[2mms[22m[39m
   [33m[2m‚úì[22m[39m Inventory Service Integration Tests[2m > [22mgetAvailableBooks - Search with special LIKE characters[2m > [22mshould find a book with a literal "%" in the title [33m 744[2mms[22m[39m
   [33m[2m‚úì[22m[39m Inventory Service Integration Tests[2m > [22mgetAvailableBooks - Search with special LIKE characters[2m > [22mshould find a book with literal "__" in the title and not treat it as a wildcard [33m 670[2mms[22m[39m
   [33m[2m‚úì[22m[39m Inventory Service Integration Tests[2m > [22mgetAvailableBooks - Search with special LIKE characters[2m > [22mshould find a book with "C++" without treating "+" as a special character [33m 650[2mms[22m[39m
   [33m[2m‚úì[22m[39m Inventory Service Integration Tests[2m > [22mgetAvailableBooks - Search with special LIKE characters[2m > [22mshould handle search terms with multiple special characters [33m 671[2mms[22m[39m
[90mstdout[2m | src/tests/error-handling.integration.test.ts[2m > [22m[2mError Handling Integration Tests
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

[90mstderr[2m | src/tests/error-handling.integration.test.ts[2m > [22m[2mError Handling Integration Tests
[22m[39m‚úÖ Test database URL set for worker 1: postgres://test:test@localhost...

[90mstderr[2m | src/tests/error-handling.integration.test.ts[2m > [22m[2mError Handling Integration Tests
[22m[39m!!! WARNING: Failed to initialize WeChat Pay SDK. Payment features will be disabled. Reason: WeChat Pay configuration is incomplete or certificate files are missing.

[90mstderr[2m | src/tests/error-handling.integration.test.ts[2m > [22m[2mError Handling Integration Tests
[22m[39mMetrics endpoint registered at /metrics

{"level":30,"time":1760782634201,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","req":{"method":"GET","url":"/api/orders/my","hostname":"127.0.0.1:11646","remoteAddress":"::ffff:127.0.0.1","remotePort":11652},"msg":"incoming request"}
{"level":30,"time":1760782634202,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","res":{"statusCode":401},"responseTime":0.6167999999597669,"msg":"request completed"}
{"level":30,"time":1760782634807,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","req":{"method":"GET","url":"/api/orders/my","hostname":"127.0.0.1:11653","remoteAddress":"::ffff:127.0.0.1","remotePort":11654},"msg":"incoming request"}
{"level":40,"time":1760782634808,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","err":{"type":"TokenError","message":"The token is malformed.","stack":"Error: The token is malformed.\n    at decode (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fast-jwt\\src\\decoder.js:18:11)\n    at verify (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fast-jwt\\src\\verifier.js:285:15)\n    at Object.authenticate (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\plugins\\auth.ts:17:29)\n    at hookIterator (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\hooks.js:405:10)\n    at next (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\hooks.js:239:18)\n    at hookRunner (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\hooks.js:261:5)\n    at validationCompleted (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:116:5)\n    at preValidationCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:100:5)\n    at handler (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:77:7)\n    at handleRequest (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:24:5)","code":"FAST_JWT_MALFORMED"},"msg":"Authentication failed"}
{"level":30,"time":1760782634811,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","res":{"statusCode":401},"responseTime":3.735799999907613,"msg":"request completed"}
{"level":30,"time":1760782635419,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-3","req":{"method":"GET","url":"/api/orders/pending-pickup","hostname":"127.0.0.1:11655","remoteAddress":"::ffff:127.0.0.1","remotePort":11656},"msg":"incoming request"}
{"level":30,"time":1760782635426,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-3","res":{"statusCode":403},"responseTime":6.723799999803305,"msg":"request completed"}
{"level":30,"time":1760782636044,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:11657","remoteAddress":"::ffff:127.0.0.1","remotePort":11658},"msg":"incoming request"}
{"level":50,"time":1760782636045,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","err":{"type":"Error","message":"body/status must be equal to constant, body/status must be equal to constant, body/status must match a schema in anyOf","stack":"Error: body/status must be equal to constant, body/status must be equal to constant, body/status must match a schema in anyOf\n    at defaultSchemaErrorFormatter (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\context.js:114:10)\n    at wrapValidationError (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\validation.js:249:17)\n    at validate (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\validation.js:167:16)\n    at preValidationCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:93:25)\n    at handler (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:77:7)\n    at C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at done (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:304:5)\n    at IncomingMessage.onEnd (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:283:27)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"/status","schemaPath":"#/properties/status/anyOf/0/const","keyword":"const","params":{"allowedValue":"COMPLETED"},"message":"must be equal to constant"},{"instancePath":"/status","schemaPath":"#/properties/status/anyOf/1/const","keyword":"const","params":{"allowedValue":"CANCELLED"},"message":"must be equal to constant"},{"instancePath":"/status","schemaPath":"#/properties/status/anyOf","keyword":"anyOf","params":{},"message":"must match a schema in anyOf"}],"validationContext":"body"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:11657","remoteAddress":"::ffff:127.0.0.1","remotePort":11658},"msg":"An error occurred during the request"}
{"level":30,"time":1760782636046,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","res":{"statusCode":400},"responseTime":1.3527999999932945,"msg":"request completed"}
{"level":30,"time":1760782636770,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-5","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:8400","remoteAddress":"::ffff:127.0.0.1","remotePort":8401},"msg":"incoming request"}
{"level":50,"time":1760782636771,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-5","err":{"type":"Error","message":"body must have required property 'status'","stack":"Error: body must have required property 'status'\n    at defaultSchemaErrorFormatter (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\context.js:114:10)\n    at wrapValidationError (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\validation.js:249:17)\n    at validate (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\validation.js:167:16)\n    at preValidationCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:93:25)\n    at handler (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:77:7)\n    at C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at done (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:304:5)\n    at IncomingMessage.onEnd (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:283:27)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"","schemaPath":"#/required","keyword":"required","params":{"missingProperty":"status"},"message":"must have required property 'status'"}],"validationContext":"body"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:8400","remoteAddress":"::ffff:127.0.0.1","remotePort":8401},"msg":"An error occurred during the request"}
{"level":30,"time":1760782636772,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-5","res":{"statusCode":400},"responseTime":1.0614999998360872,"msg":"request completed"}
{"level":30,"time":1760782637431,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-6","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:8407","remoteAddress":"::ffff:127.0.0.1","remotePort":8408},"msg":"incoming request"}
{"level":50,"time":1760782637432,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-6","err":{"type":"SyntaxError","message":"Unexpected token 'i', \"invalid-json{\" is not valid JSON","stack":"SyntaxError: Unexpected token 'i', \"invalid-json{\" is not valid JSON","statusCode":400},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:8407","remoteAddress":"::ffff:127.0.0.1","remotePort":8408},"msg":"An error occurred during the request"}
{"level":30,"time":1760782637432,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-6","res":{"statusCode":400},"responseTime":0.703899999614805,"msg":"request completed"}
{"level":30,"time":1760782638227,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-7","req":{"method":"GET","url":"/api/inventory/available?search=a","hostname":"127.0.0.1:8415","remoteAddress":"::ffff:127.0.0.1","remotePort":8416},"msg":"incoming request"}
{"level":30,"time":1760782638234,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-7","res":{"statusCode":200},"responseTime":7.013499999884516,"msg":"request completed"}
{"level":30,"time":1760782639022,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-8","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13848},"msg":"incoming request"}
{"level":30,"time":1760782639023,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-9","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13855},"msg":"incoming request"}
{"level":30,"time":1760782639024,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-a","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13858},"msg":"incoming request"}
{"level":30,"time":1760782639024,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-b","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13861},"msg":"incoming request"}
{"level":30,"time":1760782639024,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-c","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13849},"msg":"incoming request"}
{"level":30,"time":1760782639025,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-d","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13850},"msg":"incoming request"}
{"level":30,"time":1760782639025,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-e","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13851},"msg":"incoming request"}
{"level":30,"time":1760782639026,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-f","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13852},"msg":"incoming request"}
{"level":30,"time":1760782639026,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-g","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13853},"msg":"incoming request"}
{"level":30,"time":1760782639027,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-h","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13854},"msg":"incoming request"}
{"level":30,"time":1760782639028,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-i","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13856},"msg":"incoming request"}
{"level":30,"time":1760782639028,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-j","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13857},"msg":"incoming request"}
{"level":30,"time":1760782639029,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-k","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13859},"msg":"incoming request"}
{"level":30,"time":1760782639030,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-l","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13860},"msg":"incoming request"}
{"level":30,"time":1760782639030,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-m","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13862},"msg":"incoming request"}
{"level":30,"time":1760782639031,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782639031,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782639031,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782639031,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782639031,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782639031,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782639031,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782639031,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782639031,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782639033,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782639033,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782639033,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782639033,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782639033,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782639033,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":50,"time":1760782639040,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-a","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13858},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639043,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-a","res":{"statusCode":404},"responseTime":19.139400000218302,"msg":"request completed"}
{"level":50,"time":1760782639043,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-d","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13850},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639045,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-d","res":{"statusCode":404},"responseTime":20.337000000290573,"msg":"request completed"}
{"level":50,"time":1760782639046,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-8","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13848},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639047,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-8","res":{"statusCode":404},"responseTime":23.986500000115484,"msg":"request completed"}
{"level":50,"time":1760782639047,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-9","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13855},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639048,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-9","res":{"statusCode":404},"responseTime":24.43570000026375,"msg":"request completed"}
{"level":50,"time":1760782639048,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-f","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13852},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639048,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-f","res":{"statusCode":404},"responseTime":22.425700000021607,"msg":"request completed"}
{"level":50,"time":1760782639048,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-c","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13849},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639049,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-c","res":{"statusCode":404},"responseTime":24.23769999993965,"msg":"request completed"}
{"level":50,"time":1760782639049,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-g","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13853},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639049,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-g","res":{"statusCode":404},"responseTime":23.21460000006482,"msg":"request completed"}
{"level":50,"time":1760782639050,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-b","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13861},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639050,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-b","res":{"statusCode":404},"responseTime":26.14559999993071,"msg":"request completed"}
{"level":50,"time":1760782639056,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-e","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13851},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639056,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-e","res":{"statusCode":404},"responseTime":31.3257999997586,"msg":"request completed"}
{"level":50,"time":1760782639059,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-h","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13854},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639059,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-h","res":{"statusCode":404},"responseTime":32.442000000271946,"msg":"request completed"}
{"level":50,"time":1760782639066,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-i","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13856},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639067,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-i","res":{"statusCode":404},"responseTime":38.934100000187755,"msg":"request completed"}
{"level":50,"time":1760782639067,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-k","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13859},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639068,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-k","res":{"statusCode":404},"responseTime":39.04260000027716,"msg":"request completed"}
{"level":50,"time":1760782639068,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-m","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13862},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639069,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-m","res":{"statusCode":404},"responseTime":38.56000000005588,"msg":"request completed"}
{"level":50,"time":1760782639069,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-j","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13857},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639069,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-j","res":{"statusCode":404},"responseTime":40.678700000047684,"msg":"request completed"}
{"level":50,"time":1760782639070,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-l","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:13847","remoteAddress":"::ffff:127.0.0.1","remotePort":13860},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639070,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-l","res":{"statusCode":404},"responseTime":40.72169999964535,"msg":"request completed"}
{"level":30,"time":1760782639751,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-n","req":{"method":"PATCH","url":"/api/orders/99999/status","hostname":"127.0.0.1:13868","remoteAddress":"::ffff:127.0.0.1","remotePort":13869},"msg":"incoming request"}
{"level":30,"time":1760782639756,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":50,"time":1760782639762,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-n","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/99999/status","hostname":"127.0.0.1:13868","remoteAddress":"::ffff:127.0.0.1","remotePort":13869},"msg":"An error occurred during the request"}
{"level":30,"time":1760782639763,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-n","res":{"statusCode":404},"responseTime":11.463600000366569,"msg":"request completed"}
{"level":30,"time":1760782640448,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-o","req":{"method":"PATCH","url":"/api/orders/invalid-id/status","hostname":"127.0.0.1:6342","remoteAddress":"::ffff:127.0.0.1","remotePort":6343},"msg":"incoming request"}
{"level":50,"time":1760782640449,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-o","err":{"type":"Error","message":"params/id must be number","stack":"Error: params/id must be number\n    at defaultSchemaErrorFormatter (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\context.js:114:10)\n    at wrapValidationError (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\validation.js:249:17)\n    at validate (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\validation.js:145:16)\n    at preValidationCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:93:25)\n    at handler (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:77:7)\n    at C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at done (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:304:5)\n    at IncomingMessage.onEnd (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:283:27)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"/id","schemaPath":"#/properties/id/type","keyword":"type","params":{"type":"number"},"message":"must be number"}],"validationContext":"params"},"req":{"method":"PATCH","url":"/api/orders/invalid-id/status","hostname":"127.0.0.1:6342","remoteAddress":"::ffff:127.0.0.1","remotePort":6343},"msg":"An error occurred during the request"}
{"level":30,"time":1760782640449,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-o","res":{"statusCode":400},"responseTime":0.5947000002488494,"msg":"request completed"}
{"level":30,"time":1760782641105,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-p","req":{"method":"POST","url":"/api/orders/create","hostname":"127.0.0.1:6344","remoteAddress":"::ffff:127.0.0.1","remotePort":6345},"msg":"incoming request"}
{"level":30,"time":1760782641150,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-p","res":{"statusCode":201},"responseTime":44.970899999607354,"msg":"request completed"}
{"level":30,"time":1760782641153,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-q","req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:6346","remoteAddress":"::ffff:127.0.0.1","remotePort":6347},"msg":"incoming request"}
{"level":30,"time":1760782641156,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":50,"time":1760782641166,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-q","err":{"type":"ApiError","message":"Êó†Ê≥ïÂ∞ÜËÆ¢Âçï‰ªé PENDING_PAYMENT Êõ¥Êñ∞‰∏∫ COMPLETED","stack":"ApiError: Êó†Ê≥ïÂ∞ÜËÆ¢Âçï‰ªé PENDING_PAYMENT Êõ¥Êñ∞‰∏∫ COMPLETED\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:80:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":400,"code":"INVALID_STATUS_TRANSITION"},"req":{"method":"PATCH","url":"/api/orders/1/status","hostname":"127.0.0.1:6346","remoteAddress":"::ffff:127.0.0.1","remotePort":6347},"msg":"An error occurred during the request"}
{"level":30,"time":1760782641166,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-q","res":{"statusCode":400},"responseTime":13.120800000149757,"msg":"request completed"}
{"level":30,"time":1760782641825,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-r","req":{"method":"GET","url":"/api/inventory/item/99999","hostname":"127.0.0.1:6348","remoteAddress":"::ffff:127.0.0.1","remotePort":6349},"msg":"incoming request"}
{"level":50,"time":1760782641830,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-r","err":{"type":"ApiError","message":"Book not found.","stack":"ApiError: Book not found.\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\inventory.ts:66:15)","name":"ApiError","statusCode":404,"code":"BOOK_NOT_FOUND"},"req":{"method":"GET","url":"/api/inventory/item/99999","hostname":"127.0.0.1:6348","remoteAddress":"::ffff:127.0.0.1","remotePort":6349},"msg":"An error occurred during the request"}
{"level":30,"time":1760782641833,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-r","res":{"statusCode":404},"responseTime":7.622599999886006,"msg":"request completed"}
{"level":30,"time":1760782642459,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-s","req":{"method":"GET","url":"/api/orders/my","hostname":"127.0.0.1:4771","remoteAddress":"::ffff:127.0.0.1","remotePort":4772},"msg":"incoming request"}
{"level":30,"time":1760782642459,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-s","res":{"statusCode":401},"responseTime":0.2985999998636544,"msg":"request completed"}
{"level":30,"time":1760782642462,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-t","req":{"method":"GET","url":"/api/orders/pending-pickup","hostname":"127.0.0.1:4773","remoteAddress":"::ffff:127.0.0.1","remotePort":4774},"msg":"incoming request"}
{"level":30,"time":1760782642465,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-t","res":{"statusCode":403},"responseTime":2.361299999989569,"msg":"request completed"}
{"level":30,"time":1760782642467,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-u","req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:4775","remoteAddress":"::ffff:127.0.0.1","remotePort":4776},"msg":"incoming request"}
{"level":50,"time":1760782642468,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-u","err":{"type":"Error","message":"body must have required property 'status'","stack":"Error: body must have required property 'status'\n    at defaultSchemaErrorFormatter (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\context.js:114:10)\n    at wrapValidationError (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\validation.js:249:17)\n    at validate (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\validation.js:167:16)\n    at preValidationCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:93:25)\n    at handler (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:77:7)\n    at C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at done (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:304:5)\n    at IncomingMessage.onEnd (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:283:27)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"","schemaPath":"#/required","keyword":"required","params":{"missingProperty":"status"},"message":"must have required property 'status'"}],"validationContext":"body"},"req":{"method":"PATCH","url":"/api/orders/123/status","hostname":"127.0.0.1:4775","remoteAddress":"::ffff:127.0.0.1","remotePort":4776},"msg":"An error occurred during the request"}
{"level":30,"time":1760782642468,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-u","res":{"statusCode":400},"responseTime":0.6795000000856817,"msg":"request completed"}
{"level":30,"time":1760782642472,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-v","req":{"method":"PATCH","url":"/api/orders/99999/status","hostname":"127.0.0.1:4777","remoteAddress":"::ffff:127.0.0.1","remotePort":4778},"msg":"incoming request"}
{"level":30,"time":1760782642473,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":2,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":50,"time":1760782642477,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-v","err":{"type":"ApiError","message":"ËÆ¢Âçï‰∏çÂ≠òÂú®","stack":"ApiError: ËÆ¢Âçï‰∏çÂ≠òÂú®\n    at updateOrderStatusImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\management.ts:67:11)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:168:28)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"PATCH","url":"/api/orders/99999/status","hostname":"127.0.0.1:4777","remoteAddress":"::ffff:127.0.0.1","remotePort":4778},"msg":"An error occurred during the request"}
{"level":30,"time":1760782642477,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-v","res":{"statusCode":404},"responseTime":5.330199999734759,"msg":"request completed"}
{"level":30,"time":1760782643153,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-w","req":{"method":"GET","url":"/api/health","hostname":"127.0.0.1:4780","remoteAddress":"::ffff:127.0.0.1","remotePort":4781},"msg":"incoming request"}
{"level":30,"time":1760782643155,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-w","res":{"statusCode":200},"responseTime":2.1655000001192093,"msg":"request completed"}
 [32m‚úì[39m src/tests/error-handling.integration.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 9723[2mms[22m[39m
   [33m[2m‚úì[22m[39m Error Handling Integration Tests[2m > [22mLayer 1: Authentication/Authorization Errors (401/403)[2m > [22mshould return 401 with correct format for missing token [33m 605[2mms[22m[39m
   [33m[2m‚úì[22m[39m Error Handling Integration Tests[2m > [22mLayer 1: Authentication/Authorization Errors (401/403)[2m > [22mshould return 401 with correct format for invalid token [33m 618[2mms[22m[39m
   [33m[2m‚úì[22m[39m Error Handling Integration Tests[2m > [22mLayer 1: Authentication/Authorization Errors (401/403)[2m > [22mshould return 403 with correct format for insufficient permissions [33m 620[2mms[22m[39m
   [33m[2m‚úì[22m[39m Error Handling Integration Tests[2m > [22mLayer 2: Request Validation Errors (400)[2m > [22mshould return 400 with correct format for invalid request body [33m 659[2mms[22m[39m
   [33m[2m‚úì[22m[39m Error Handling Integration Tests[2m > [22mLayer 2: Request Validation Errors (400)[2m > [22mshould return 400 with correct format for missing required fields [33m 696[2mms[22m[39m
   [33m[2m‚úì[22m[39m Error Handling Integration Tests[2m > [22mLayer 2: Request Validation Errors (400)[2m > [22mshould return 400 with correct format for invalid JSON [33m 802[2mms[22m[39m
   [33m[2m‚úì[22m[39m Error Handling Integration Tests[2m > [22mLayer 2: Request Validation Errors (400)[2m > [22mshould accept inventory search queries with single character [33m 672[2mms[22m[39m
   [33m[2m‚úì[22m[39m Error Handling Integration Tests[2m > [22mLayer 3: Rate Limiting Errors (429)[2m > [22mshould return 429 with correct format when rate limit exceeded [33m 882[2mms[22m[39m
   [33m[2m‚úì[22m[39m Error Handling Integration Tests[2m > [22mLayer 4: Business Logic Errors (ApiError)[2m > [22mshould return correct format for business logic error [33m 629[2mms[22m[39m
   [33m[2m‚úì[22m[39m Error Handling Integration Tests[2m > [22mLayer 4: Business Logic Errors (ApiError)[2m > [22mshould return correct format for invalid order ID [33m 684[2mms[22m[39m
   [33m[2m‚úì[22m[39m Error Handling Integration Tests[2m > [22mLayer 4: Business Logic Errors (ApiError)[2m > [22mshould return correct format for invalid status transition [33m 740[2mms[22m[39m
   [33m[2m‚úì[22m[39m Error Handling Integration Tests[2m > [22mLayer 5: Database Errors (Prisma)[2m > [22mshould return correct format for record not found [33m 641[2mms[22m[39m
   [33m[2m‚úì[22m[39m Error Handling Integration Tests[2m > [22mError Response Format Consistency[2m > [22mshould always return consistent error structure [33m 688[2mms[22m[39m
   [33m[2m‚úì[22m[39m Error Handling Integration Tests[2m > [22mSuccess Response Format[2m > [22mshould return success responses without error fields [33m 616[2mms[22m[39m
[90mstdout[2m | src/tests/paymentSecurity.integration.test.ts[2m > [22m[2mPayment Security Integration Tests
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

[90mstderr[2m | src/tests/paymentSecurity.integration.test.ts[2m > [22m[2mPayment Security Integration Tests
[22m[39m‚úÖ Test database URL set for worker 1: postgres://test:test@localhost...

{"level":30,"time":1760782643624,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","msg":"WeChat Pay SDK initialized successfully"}
[90mstderr[2m | src/tests/paymentSecurity.integration.test.ts[2m > [22m[2mPayment Security Integration Tests
[22m[39mMetrics endpoint registered at /metrics

{"level":30,"time":1760782644022,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","req":{"method":"POST","url":"/api/payment/notify","hostname":"127.0.0.1:4784","remoteAddress":"::ffff:127.0.0.1","remotePort":4785},"msg":"incoming request"}
{"level":40,"time":1760782644036,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","err":{"type":"SyntaxError","message":"\"undefined\" is not valid JSON","stack":"SyntaxError: \"undefined\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\payment.ts:108:33)\n    at preHandlerCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:139:37)\n    at validationCompleted (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:123:5)\n    at preValidationCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:100:5)\n    at handler (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:77:7)\n    at C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at done (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:304:5)"},"resource":{"ciphertext":"mock-ciphertext","associated_data":"mock-associated-data","nonce":"mock-nonce"},"msg":"Payment notification decryption failed. Likely a malformed/malicious request."}
{"level":30,"time":1760782644038,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","res":{"statusCode":200},"responseTime":15.983200000133365,"msg":"request completed"}
{"level":30,"time":1760782644637,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","req":{"method":"POST","url":"/api/payment/notify","hostname":"127.0.0.1:4786","remoteAddress":"::ffff:127.0.0.1","remotePort":4787},"msg":"incoming request"}
{"level":40,"time":1760782644638,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","err":{"type":"SyntaxError","message":"\"undefined\" is not valid JSON","stack":"SyntaxError: \"undefined\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\payment.ts:108:33)\n    at preHandlerCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:139:37)\n    at validationCompleted (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:123:5)\n    at preValidationCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:100:5)\n    at handler (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:77:7)\n    at C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at done (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:304:5)"},"resource":{"ciphertext":"mock-ciphertext","associated_data":"mock-associated-data","nonce":"mock-nonce"},"msg":"Payment notification decryption failed. Likely a malformed/malicious request."}
{"level":30,"time":1760782644638,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","res":{"statusCode":200},"responseTime":1.5145999998785555,"msg":"request completed"}
{"level":30,"time":1760782645395,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-3","req":{"method":"POST","url":"/api/payment/notify","hostname":"127.0.0.1:4788","remoteAddress":"::ffff:127.0.0.1","remotePort":4789},"msg":"incoming request"}
{"level":40,"time":1760782645395,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-3","err":{"type":"SyntaxError","message":"\"undefined\" is not valid JSON","stack":"SyntaxError: \"undefined\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\payment.ts:108:33)\n    at preHandlerCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:139:37)\n    at validationCompleted (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:123:5)\n    at preValidationCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:100:5)\n    at handler (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:77:7)\n    at C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at done (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:304:5)"},"resource":{"ciphertext":"mock-ciphertext","associated_data":"mock-associated-data","nonce":"mock-nonce"},"msg":"Payment notification decryption failed. Likely a malformed/malicious request."}
{"level":30,"time":1760782645396,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-3","res":{"statusCode":200},"responseTime":0.9306000000797212,"msg":"request completed"}
{"level":30,"time":1760782646092,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","req":{"method":"POST","url":"/api/payment/notify","hostname":"127.0.0.1:8759","remoteAddress":"::ffff:127.0.0.1","remotePort":8760},"msg":"incoming request"}
{"level":50,"time":1760782646093,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","err":{"type":"FastifyError","message":"Body cannot be empty when content-type is set to 'application/json'","stack":"FastifyError: Body cannot be empty when content-type is set to 'application/json'\n    at Parser.defaultJsonParser [as fn] (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:295:19)\n    at IncomingMessage.onEnd (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:283:27)\n    at IncomingMessage.emit (node:events:530:35)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at processTicksAndRejections (node:internal/process/task_queues:90:21)","code":"FST_ERR_CTP_EMPTY_JSON_BODY","name":"FastifyError","statusCode":400},"req":{"method":"POST","url":"/api/payment/notify","hostname":"127.0.0.1:8759","remoteAddress":"::ffff:127.0.0.1","remotePort":8760},"msg":"An error occurred during the request"}
{"level":30,"time":1760782646094,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","res":{"statusCode":400},"responseTime":1.516800000332296,"msg":"request completed"}
{"level":30,"time":1760782646693,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-5","req":{"method":"POST","url":"/api/payment/notify","hostname":"127.0.0.1:8761","remoteAddress":"::ffff:127.0.0.1","remotePort":8762},"msg":"incoming request"}
[90mstderr[2m | src/tests/paymentSecurity.integration.test.ts[2m > [22m[2mPayment Security Integration Tests[2m > [22m[2mPayment Callback Security Fortress - HTTP Layer[2m > [22m[2mshould accept valid requests with proper timestamp and signature
[22m[39mPayment notification for unknown out_trade_no UNKNOWN_PAYMENT received. Ignoring.

{"level":30,"time":1760782646698,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-5","res":{"statusCode":200},"responseTime":4.338299999944866,"msg":"request completed"}
{"level":30,"time":1760782647300,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-6","req":{"method":"POST","url":"/api/payment/notify","hostname":"127.0.0.1:8767","remoteAddress":"::ffff:127.0.0.1","remotePort":8768},"msg":"incoming request"}
[90mstderr[2m | src/tests/paymentSecurity.integration.test.ts[2m > [22m[2mPayment Security Integration Tests[2m > [22m[2mPayment Business Logic - ÁúüÊ≠£ÁöÑÊàêÂäüÂíåÂ§±Ë¥•Âú∫ÊôØ[2m > [22m[2mshould handle successful payment notification
[22m[39mPayment notification for unknown out_trade_no TEST_ORDER_12345 received. Ignoring.

{"level":30,"time":1760782647303,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-6","res":{"statusCode":200},"responseTime":3.5274000000208616,"msg":"request completed"}
{"level":30,"time":1760782647924,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-7","req":{"method":"POST","url":"/api/payment/notify","hostname":"127.0.0.1:6717","remoteAddress":"::ffff:127.0.0.1","remotePort":6718},"msg":"incoming request"}
[90mstderr[2m | src/tests/paymentSecurity.integration.test.ts[2m > [22m[2mPayment Security Integration Tests[2m > [22m[2mPayment Business Logic - ÁúüÊ≠£ÁöÑÊàêÂäüÂíåÂ§±Ë¥•Âú∫ÊôØ[2m > [22m[2mshould handle failed payment notification
[22m[39mPayment notification for unknown out_trade_no TEST_ORDER_12345 received. Ignoring.

{"level":30,"time":1760782647927,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-7","res":{"statusCode":200},"responseTime":3.381599999964237,"msg":"request completed"}
{"level":30,"time":1760782648604,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-8","req":{"method":"POST","url":"/api/payment/notify","hostname":"127.0.0.1:6719","remoteAddress":"::ffff:127.0.0.1","remotePort":6720},"msg":"incoming request"}
[90mstdout[2m | src/tests/paymentSecurity.integration.test.ts[2m > [22m[2mPayment Security Integration Tests[2m > [22m[2mPayment Business Logic - ÁúüÊ≠£ÁöÑÊàêÂäüÂíåÂ§±Ë¥•Âú∫ÊôØ[2m > [22m[2mshould persist payment success and transition order status
[22m[39mOrder 1 successfully updated to PENDING_PICKUP.

{"level":30,"time":1760782648624,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-8","res":{"statusCode":200},"responseTime":19.926800000015646,"msg":"request completed"}
{"level":30,"time":1760782649382,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-9","req":{"method":"POST","url":"/api/payment/notify","hostname":"127.0.0.1:6721","remoteAddress":"::ffff:127.0.0.1","remotePort":6722},"msg":"incoming request"}
[90mstderr[2m | src/tests/paymentSecurity.integration.test.ts[2m > [22m[2mPayment Security Integration Tests[2m > [22m[2mPayment Business Logic - ÁúüÊ≠£ÁöÑÊàêÂäüÂíåÂ§±Ë¥•Âú∫ÊôØ[2m > [22m[2mshould mark payment record as FAILED when gateway reports final failure
[22m[39mPayment for TEST_FAIL_1760782649358 is in a final failure state (CLOSED). Marked as FAILED.

{"level":30,"time":1760782649397,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-9","res":{"statusCode":200},"responseTime":14.996999999973923,"msg":"request completed"}
{"level":30,"time":1760782650225,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-a","req":{"method":"POST","url":"/api/payment/notify","hostname":"127.0.0.1:2853","remoteAddress":"::ffff:127.0.0.1","remotePort":2854},"msg":"incoming request"}
[90mstderr[2m | src/tests/paymentSecurity.integration.test.ts[2m > [22m[2mPayment Security Integration Tests[2m > [22m[2mPayment Business Logic - ÁúüÊ≠£ÁöÑÊàêÂäüÂíåÂ§±Ë¥•Âú∫ÊôØ[2m > [22m[2mshould mark payment record as FAILED when gateway returns PAYERROR
[22m[39mPayment for TEST_PAYERROR_1760782650199 is in a final failure state (PAYERROR). Marked as FAILED.

{"level":30,"time":1760782650238,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-a","res":{"statusCode":200},"responseTime":13.133499999996275,"msg":"request completed"}
{"level":30,"time":1760782650923,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-b","req":{"method":"POST","url":"/api/payment/notify","hostname":"127.0.0.1:2855","remoteAddress":"::ffff:127.0.0.1","remotePort":2856},"msg":"incoming request"}
[90mstderr[2m | src/tests/paymentSecurity.integration.test.ts[2m > [22m[2mPayment Security Integration Tests[2m > [22m[2mPayment Business Logic - ÁúüÊ≠£ÁöÑÊàêÂäüÂíåÂ§±Ë¥•Âú∫ÊôØ[2m > [22m[2mshould handle unknown order notification
[22m[39mPayment notification for unknown out_trade_no NONEXISTENT_ORDER_99999 received. Ignoring.

{"level":30,"time":1760782650926,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-b","res":{"statusCode":200},"responseTime":3.2475000000558794,"msg":"request completed"}
{"level":30,"time":1760782651522,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-c","req":{"method":"POST","url":"/api/payment/notify","hostname":"127.0.0.1:2857","remoteAddress":"::ffff:127.0.0.1","remotePort":2858},"msg":"incoming request"}
{"level":40,"time":1760782651522,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-c","err":{"type":"SyntaxError","message":"Unexpected token 'i', \"invalid-json{\" is not valid JSON","stack":"SyntaxError: Unexpected token 'i', \"invalid-json{\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\payment.ts:108:33)\n    at preHandlerCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:139:37)\n    at validationCompleted (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:123:5)\n    at preValidationCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:100:5)\n    at handler (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\handleRequest.js:77:7)\n    at C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at done (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\fastify\\lib\\contentTypeParser.js:304:5)"},"resource":{"ciphertext":"mock-ciphertext","associated_data":"mock-associated-data","nonce":"mock-nonce"},"msg":"Payment notification decryption failed. Likely a malformed/malicious request."}
{"level":30,"time":1760782651523,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-c","res":{"statusCode":200},"responseTime":0.724999999627471,"msg":"request completed"}
[90mstderr[2m | src/tests/paymentSecurity.integration.test.ts[2m > [22m[2mPayment Security Integration Tests[2m > [22m[2mAmount Mismatch Alert Mechanism[2m > [22m[2mshould trigger an amount mismatch alert if order total is inconsistent
[22m[39m{ orderId: [33m1[39m, storedAmount: [33m99999[39m, calculatedAmount: [33m5000[39m, userId: [33m1[39m } CRITICAL: Amount mismatch detected for order 1. This indicates data corruption!

 [32m‚úì[39m src/tests/paymentSecurity.integration.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 9035[2mms[22m[39m
   [33m[2m‚úì[22m[39m Payment Security Integration Tests[2m > [22mPayment Callback Security Fortress - HTTP Layer[2m > [22mshould reject requests with expired timestamps (Èò≤ÈáçÊîæÊîªÔøΩ? [33m 656[2mms[22m[39m
   [33m[2m‚úì[22m[39m Payment Security Integration Tests[2m > [22mPayment Callback Security Fortress - HTTP Layer[2m > [22mshould reject requests with future timestamps (Èò≤ÈáçÊîæÊîªÔøΩ? [33m 678[2mms[22m[39m
   [33m[2m‚úì[22m[39m Payment Security Integration Tests[2m > [22mPayment Callback Security Fortress - HTTP Layer[2m > [22mshould reject requests with invalid signatures [33m 759[2mms[22m[39m
   [33m[2m‚úì[22m[39m Payment Security Integration Tests[2m > [22mPayment Callback Security Fortress - HTTP Layer[2m > [22mshould handle missing raw body gracefully [33m 623[2mms[22m[39m
   [33m[2m‚úì[22m[39m Payment Security Integration Tests[2m > [22mPayment Callback Security Fortress - HTTP Layer[2m > [22mshould accept valid requests with proper timestamp and signature [33m 603[2mms[22m[39m
   [33m[2m‚úì[22m[39m Payment Security Integration Tests[2m > [22mPayment Business Logic - ÁúüÊ≠£ÁöÑÊàêÂäüÂíåÂ§±Ë¥•Âú∫ÊôØ[2m > [22mshould handle successful payment notification [33m 617[2mms[22m[39m
   [33m[2m‚úì[22m[39m Payment Security Integration Tests[2m > [22mPayment Business Logic - ÁúüÊ≠£ÁöÑÊàêÂäüÂíåÂ§±Ë¥•Âú∫ÊôØ[2m > [22mshould handle failed payment notification [33m 630[2mms[22m[39m
   [33m[2m‚úì[22m[39m Payment Security Integration Tests[2m > [22mPayment Business Logic - ÁúüÊ≠£ÁöÑÊàêÂäüÂíåÂ§±Ë¥•Âú∫ÊôØ[2m > [22mshould persist payment success and transition order status [33m 725[2mms[22m[39m
   [33m[2m‚úì[22m[39m Payment Security Integration Tests[2m > [22mPayment Business Logic - ÁúüÊ≠£ÁöÑÊàêÂäüÂíåÂ§±Ë¥•Âú∫ÊôØ[2m > [22mshould mark payment record as FAILED when gateway reports final failure [33m 833[2mms[22m[39m
   [33m[2m‚úì[22m[39m Payment Security Integration Tests[2m > [22mPayment Business Logic - ÁúüÊ≠£ÁöÑÊàêÂäüÂíåÂ§±Ë¥•Âú∫ÊôØ[2m > [22mshould mark payment record as FAILED when gateway returns PAYERROR [33m 811[2mms[22m[39m
   [33m[2m‚úì[22m[39m Payment Security Integration Tests[2m > [22mPayment Business Logic - ÁúüÊ≠£ÁöÑÊàêÂäüÂíåÂ§±Ë¥•Âú∫ÊôØ[2m > [22mshould handle unknown order notification [33m 613[2mms[22m[39m
   [33m[2m‚úì[22m[39m Payment Security Integration Tests[2m > [22mPayment Business Logic - ÁúüÊ≠£ÁöÑÊàêÂäüÂíåÂ§±Ë¥•Âú∫ÊôØ[2m > [22mshould handle malformed decrypted data [33m 580[2mms[22m[39m
   [33m[2m‚úì[22m[39m Payment Security Integration Tests[2m > [22mAmount Mismatch Alert Mechanism[2m > [22mshould trigger an amount mismatch alert if order total is inconsistent [33m 784[2mms[22m[39m
[90mstdout[2m | src/tests/order.integration.test.ts[2m > [22m[2mOrder Integration Tests
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

[90mstderr[2m | src/tests/order.integration.test.ts[2m > [22m[2mOrder Integration Tests
[22m[39m‚úÖ Test database URL set for worker 1: postgres://test:test@localhost...

[90mstderr[2m | src/tests/order.integration.test.ts[2m > [22m[2mOrder Integration Tests
[22m[39m!!! WARNING: Failed to initialize WeChat Pay SDK. Payment features will be disabled. Reason: WeChat Pay configuration is incomplete or certificate files are missing.

[90mstderr[2m | src/tests/order.integration.test.ts[2m > [22m[2mOrder Integration Tests
[22m[39mMetrics endpoint registered at /metrics

{"level":30,"time":1760782653250,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","req":{"method":"POST","url":"/api/orders/create","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782653286,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","res":{"statusCode":201},"responseTime":35.33349999971688,"msg":"request completed"}
{"level":30,"time":1760782654038,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","req":{"method":"POST","url":"/api/orders/create","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":50,"time":1760782654052,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","err":{"type":"ApiError","message":"ÈÉ®ÂàÜ‰π¶Á±çÂ∑≤‰∏çÂèØÁî®ÔºåËØ∑Âà∑Êñ∞ÂêéÈáçËØï","stack":"ApiError: ÈÉ®ÂàÜ‰π¶Á±çÂ∑≤‰∏çÂèØÁî®ÔºåËØ∑Âà∑Êñ∞ÂêéÈáçËØï\n    at validateInventoryAndReservations (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\create.ts:128:11)\n    at createOrderImpl (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\create.ts:271:5)\n    at Proxy._transactionWithCallback (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\node_modules\\@prisma\\client\\src\\runtime\\getPrismaClient.ts:722:18)\n    at withTxRetry (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\db\\transaction.ts:78:14)\n    at createOrder (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\create.ts:313:14)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:63:21)","name":"ApiError","statusCode":409,"code":"INSUFFICIENT_INVENTORY_PRECHECK"},"req":{"method":"POST","url":"/api/orders/create","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"An error occurred during the request"}
{"level":30,"time":1760782654054,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","res":{"statusCode":409},"responseTime":15.657399999909103,"msg":"request completed"}
{"level":30,"time":1760782654897,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-3","req":{"method":"POST","url":"/api/orders/create","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782654935,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-3","res":{"statusCode":201},"responseTime":38.17009999975562,"msg":"request completed"}
{"level":30,"time":1760782654937,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","req":{"method":"GET","url":"/api/orders/1","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":50,"time":1760782654944,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","err":{"type":"ApiError","message":"Order not found","stack":"ApiError: Order not found\n    at getOrderById (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\services\\orders\\queries.ts:142:11)\n    at Object.<anonymous> (C:\\Users\\wapadil\\WeChatProjects\\miniprogram-13\\bookworm-backend\\src\\routes\\orders.ts:82:21)","name":"ApiError","statusCode":404,"code":"ORDER_NOT_FOUND"},"req":{"method":"GET","url":"/api/orders/1","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"An error occurred during the request"}
{"level":30,"time":1760782654945,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","res":{"statusCode":404},"responseTime":7.819900000002235,"msg":"request completed"}
{"level":30,"time":1760782655702,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-5","req":{"method":"POST","url":"/api/orders/create","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782655738,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-5","res":{"statusCode":201},"responseTime":36.00059999991208,"msg":"request completed"}
{"level":30,"time":1760782655739,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-6","req":{"method":"GET","url":"/api/orders/1","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782655757,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-6","res":{"statusCode":200},"responseTime":17.67590000014752,"msg":"request completed"}
{"level":30,"time":1760782656470,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-7","req":{"method":"POST","url":"/api/orders/create","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782656504,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-7","res":{"statusCode":201},"responseTime":33.47899999981746,"msg":"request completed"}
{"level":30,"time":1760782656505,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-8","req":{"method":"GET","url":"/api/orders/my","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782656516,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-8","res":{"statusCode":200},"responseTime":10.857900000177324,"msg":"request completed"}
 [32m‚úì[39m src/tests/order.integration.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 4209[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Integration Tests[2m > [22mPOST /api/orders/create[2m > [22mshould successfully create an order and reserve inventory [33m 826[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Integration Tests[2m > [22mPOST /api/orders/create[2m > [22mshould fail with invalid inventory item IDs [33m 818[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Integration Tests[2m > [22mGET /api/orders/:id - Authorization[2m > [22mshould prevent unauthorized access [33m 905[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Integration Tests[2m > [22mGET /api/orders/:id - Authorization[2m > [22mshould allow authorized access to own order [33m 744[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Integration Tests[2m > [22mGET /api/orders/my[2m > [22mshould return user order history [33m 747[2mms[22m[39m
[90mstdout[2m | src/tests/profile-and-recommendations.integration.test.ts[2m > [22m[2mUser Profile & Recommendations Integration Tests
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

[90mstderr[2m | src/tests/profile-and-recommendations.integration.test.ts[2m > [22m[2mUser Profile & Recommendations Integration Tests
[22m[39m‚úÖ Test database URL set for worker 1: postgres://test:test@localhost...

[90mstderr[2m | src/tests/profile-and-recommendations.integration.test.ts[2m > [22m[2mUser Profile & Recommendations Integration Tests
[22m[39m!!! WARNING: Failed to initialize WeChat Pay SDK. Payment features will be disabled. Reason: WeChat Pay configuration is incomplete or certificate files are missing.

[90mstderr[2m | src/tests/profile-and-recommendations.integration.test.ts[2m > [22m[2mUser Profile & Recommendations Integration Tests
[22m[39mMetrics endpoint registered at /metrics

{"level":30,"time":1760782657439,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","req":{"method":"POST","url":"/api/acquisitions","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782657444,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782657481,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","res":{"statusCode":201},"responseTime":42.5769000002183,"msg":"request completed"}
{"level":30,"time":1760782658166,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","req":{"method":"POST","url":"/api/acquisitions","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782658170,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782658192,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","res":{"statusCode":201},"responseTime":25.302900000009686,"msg":"request completed"}
{"level":30,"time":1760782658192,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-3","req":{"method":"POST","url":"/api/acquisitions","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782658197,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782658220,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-3","res":{"statusCode":201},"responseTime":27.521600000094622,"msg":"request completed"}
{"level":30,"time":1760782658932,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","req":{"method":"POST","url":"/api/acquisitions","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782658934,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782658947,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","res":{"statusCode":201},"responseTime":15.525400000158697,"msg":"request completed"}
{"level":30,"time":1760782659643,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-5","req":{"method":"POST","url":"/api/acquisitions","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782659647,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-5","res":{"statusCode":403},"responseTime":3.5923999999649823,"msg":"request completed"}
{"level":30,"time":1760782660591,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-6","req":{"method":"GET","url":"/api/books/recommendations","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782660615,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-6","res":{"statusCode":200},"responseTime":23.732400000095367,"msg":"request completed"}
{"level":30,"time":1760782661463,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-7","req":{"method":"GET","url":"/api/books/recommendations","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782661474,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-7","res":{"statusCode":200},"responseTime":10.77529999986291,"msg":"request completed"}
{"level":30,"time":1760782662081,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-8","req":{"method":"GET","url":"/api/books/recommendations","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782662084,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-8","res":{"statusCode":200},"responseTime":2.9456000002101064,"msg":"request completed"}
{"level":30,"time":1760782662723,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-9","req":{"method":"GET","url":"/api/books/recommendations","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782662728,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-9","res":{"statusCode":200},"responseTime":4.650799999944866,"msg":"request completed"}
{"level":30,"time":1760782663341,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-a","req":{"method":"GET","url":"/api/books/recommendations","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782663342,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-a","res":{"statusCode":401},"responseTime":0.2564000003039837,"msg":"request completed"}
 [32m‚úì[39m src/tests/profile-and-recommendations.integration.test.ts [2m([22m[2m9 tests[22m[2m)[22m[33m 6796[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Profile & Recommendations Integration Tests[2m > [22mPOST /api/acquisitions - Customer Profile Collection[2m > [22mÂ∫îËØ•Âú®Êî∂Ë¥≠Êó∂ÂàõÂª∫Áî®Êà∑ÁîªÂÉè [33m 784[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Profile & Recommendations Integration Tests[2m > [22mPOST /api/acquisitions - Customer Profile Collection[2m > [22mÂ∫îËØ•Âú®Á¨¨‰∫åÊ¨°Êî∂Ë¥≠Êó∂Êõ¥Êñ∞Áî®Êà∑ÁîªÂÉè [33m 743[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Profile & Recommendations Integration Tests[2m > [22mPOST /api/acquisitions - Customer Profile Collection[2m > [22mÂ∫îËØ•Âú®‰∏çÊèê‰æõÁîªÂÉèÊó∂Ê≠£Â∏∏ÂàõÂª∫Êî∂Ë¥≠ [33m 687[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Profile & Recommendations Integration Tests[2m > [22mPOST /api/acquisitions - Customer Profile Collection[2m > [22mÂ∫îËØ•ÊãíÁªùÈùûÂëòÂ∑•Áî®Êà∑ÂàõÂª∫Êî∂Ë¥≠ [33m 805[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Profile & Recommendations Integration Tests[2m > [22mGET /api/books/recommendations - Personalized Recommendations[2m > [22mÂ∫îËØ•‰∏∫ÊúâÁîªÂÉèÁöÑÁî®Êà∑ËøîÂõûÊé®Ëçê‰π¶Á±ç [33m 948[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Profile & Recommendations Integration Tests[2m > [22mGET /api/books/recommendations - Personalized Recommendations[2m > [22mÂ∫îËØ•Âè™ËøîÂõûÊúâÂ∫ìÂ≠òÁöÑÊé®Ëçê‰π¶Á±ç [33m 757[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Profile & Recommendations Integration Tests[2m > [22mGET /api/books/recommendations - Personalized Recommendations[2m > [22mÂ∫îËØ•‰∏∫Ê≤°ÊúâÁîªÂÉèÁöÑÁî®Êà∑ËøîÂõûÁ©∫Êï∞ÁªÑ [33m 629[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Profile & Recommendations Integration Tests[2m > [22mGET /api/books/recommendations - Personalized Recommendations[2m > [22mÂ∫îËØ•‰∏∫Ê≤°ÊúâÂåπÈÖçÊé®ËçêÂàóË°®ÁöÑÁî®Êà∑ËøîÂõûÁ©∫Êï∞ÁªÑ [33m 626[2mms[22m[39m
   [33m[2m‚úì[22m[39m User Profile & Recommendations Integration Tests[2m > [22mGET /api/books/recommendations - Personalized Recommendations[2m > [22mÂ∫îËØ•ÊãíÁªùÊú™ËÆ§ËØÅÁî®Êà∑ËÆøÈóÆÊé®Ëçê [33m 649[2mms[22m[39m
[90mstdout[2m | src/tests/databaseRules.integration.test.ts[2m > [22m[2mDatabase-level Business Rules
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

 [31m‚ùØ[39m src/tests/databaseRules.integration.test.ts [2m([22m[2m10 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 7560[2mms[22m[39m
[31m   [31m√ó[31m Database-level Business Rules[2m > [22mwithTxRetry[2m > [22mretries deterministically on serialization conflicts[39m[33m 976[2mms[22m[39m
[31m     ‚Üí expected 'rejected' to be 'fulfilled' // Object.is equality[39m
   [33m[2m‚úì[22m[39m Database-level Business Rules[2m > [22mwithTxRetry[2m > [22mdoes not retry for non-retryable errors [33m 836[2mms[22m[39m
   [33m[2m‚úì[22m[39m Database-level Business Rules[2m > [22mshould enforce MAX_RESERVED_ITEMS_PER_USER via trigger using custom setting [33m 796[2mms[22m[39m
   [33m[2m‚úì[22m[39m Database-level Business Rules[2m > [22mOrder type consistency check[2m > [22mshould reject a PURCHASE order carrying SELL-specific columns [33m 626[2mms[22m[39m
   [33m[2m‚úì[22m[39m Database-level Business Rules[2m > [22mOrder type consistency check[2m > [22mshould reject a SELL order missing unitPrice [33m 634[2mms[22m[39m
   [33m[2m‚úì[22m[39m Database-level Business Rules[2m > [22mOrder type consistency check[2m > [22mshould reject a VOUCHER sell order without voucherFaceValue [33m 633[2mms[22m[39m
   [33m[2m‚úì[22m[39m Database-level Business Rules[2m > [22mOrder type consistency check[2m > [22mshould accept a valid SELL order for CASH settlement [33m 619[2mms[22m[39m
   [33m[2m‚úì[22m[39m Database-level Business Rules[2m > [22mOrder type consistency check[2m > [22mshould accept a valid SELL order for VOUCHER settlement [33m 600[2mms[22m[39m
   [33m[2m‚úì[22m[39m Database-level Business Rules[2m > [22mSource order type trigger[2m > [22mshould reject an inventory item referencing a PURCHASE order [33m 951[2mms[22m[39m
   [33m[2m‚úì[22m[39m Database-level Business Rules[2m > [22mSource order type trigger[2m > [22mshould allow an inventory item referencing a SELL order [33m 883[2mms[22m[39m
[90mstdout[2m | src/tests/auth-role-revocation.integration.test.ts[2m > [22m[2mAuth: Role Revocation Integration Tests
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

[90mstderr[2m | src/tests/auth-role-revocation.integration.test.ts[2m > [22m[2mAuth: Role Revocation Integration Tests
[22m[39m‚úÖ Test database URL set for worker 1: postgres://test:test@localhost...

[90mstderr[2m | src/tests/auth-role-revocation.integration.test.ts[2m > [22m[2mAuth: Role Revocation Integration Tests
[22m[39m!!! WARNING: Failed to initialize WeChat Pay SDK. Payment features will be disabled. Reason: WeChat Pay configuration is incomplete or certificate files are missing.

[90mstderr[2m | src/tests/auth-role-revocation.integration.test.ts[2m > [22m[2mAuth: Role Revocation Integration Tests
[22m[39mMetrics endpoint registered at /metrics

{"level":30,"time":1760782671892,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","req":{"method":"POST","url":"/api/inventory/add","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782671899,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
[90mstderr[2m | src/tests/auth-role-revocation.integration.test.ts[2m > [22m[2mAuth: Role Revocation Integration Tests[2m > [22m[2mshould immediately deny access after a user role is demoted from STAFF to USER
[22m[39mTanshu API Error for ISBN 9780134685991: Status 200, code: 10001, msg: ÈîôËØØÁöÑËØ∑Ê±ÇKEY

{"level":30,"time":1760782672219,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","res":{"statusCode":201},"responseTime":326.62539999978617,"msg":"request completed"}
{"level":30,"time":1760782672226,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","req":{"method":"POST","url":"/api/inventory/add","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782672229,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","res":{"statusCode":403},"responseTime":3.2867000000551343,"msg":"request completed"}
{"level":30,"time":1760782672874,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-3","req":{"method":"POST","url":"/api/inventory/add","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782672879,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-3","res":{"statusCode":403},"responseTime":5.39559999993071,"msg":"request completed"}
{"level":30,"time":1760782672885,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","req":{"method":"POST","url":"/api/inventory/add","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782672889,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
[90mstderr[2m | src/tests/auth-role-revocation.integration.test.ts[2m > [22m[2mAuth: Role Revocation Integration Tests[2m > [22m[2mshould immediately grant access after a user role is promoted from USER to STAFF
[22m[39mTanshu API Error for ISBN 9780134685994: Status 200, code: 10001, msg: ÈîôËØØÁöÑËØ∑Ê±ÇKEY

{"level":30,"time":1760782672983,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-4","res":{"statusCode":201},"responseTime":98.42729999963194,"msg":"request completed"}
{"level":30,"time":1760782673653,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-5","req":{"method":"POST","url":"/api/inventory/add","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782673657,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
[90mstderr[2m | src/tests/auth-role-revocation.integration.test.ts[2m > [22m[2mAuth: Role Revocation Integration Tests[2m > [22m[2mshould enforce role check on every request, not just once per token
[22m[39mTanshu API Error for ISBN 9780134685995: Status 200, code: 10001, msg: ÈîôËØØÁöÑËØ∑Ê±ÇKEY

{"level":30,"time":1760782673757,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-5","res":{"statusCode":201},"responseTime":103.83030000003055,"msg":"request completed"}
{"level":30,"time":1760782673762,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-6","req":{"method":"POST","url":"/api/inventory/add","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782673766,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-6","res":{"statusCode":403},"responseTime":3.15610000025481,"msg":"request completed"}
{"level":30,"time":1760782673771,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-7","req":{"method":"POST","url":"/api/inventory/add","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782673774,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
[90mstderr[2m | src/tests/auth-role-revocation.integration.test.ts[2m > [22m[2mAuth: Role Revocation Integration Tests[2m > [22m[2mshould enforce role check on every request, not just once per token
[22m[39mTanshu API Error for ISBN 9780134685997: Status 200, code: 10001, msg: ÈîôËØØÁöÑËØ∑Ê±ÇKEY

{"level":30,"time":1760782673865,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-7","res":{"statusCode":201},"responseTime":93.55060000019148,"msg":"request completed"}
 [32m‚úì[39m src/tests/auth-role-revocation.integration.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2868[2mms[22m[39m
   [33m[2m‚úì[22m[39m Auth: Role Revocation Integration Tests[2m > [22mshould immediately deny access after a user role is demoted from STAFF to USER [33m 967[2mms[22m[39m
   [33m[2m‚úì[22m[39m Auth: Role Revocation Integration Tests[2m > [22mshould immediately grant access after a user role is promoted from USER to STAFF [33m 798[2mms[22m[39m
   [33m[2m‚úì[22m[39m Auth: Role Revocation Integration Tests[2m > [22mshould enforce role check on every request, not just once per token [33m 876[2mms[22m[39m
[90mstdout[2m | src/tests/sellOrders.integration.test.ts[2m > [22m[2mSell Orders API
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

[90mstderr[2m | src/tests/sellOrders.integration.test.ts[2m > [22m[2mSell Orders API
[22m[39m‚úÖ Test database URL set for worker 1: postgres://test:test@localhost...

[90mstderr[2m | src/tests/sellOrders.integration.test.ts[2m > [22m[2mSell Orders API
[22m[39m!!! WARNING: Failed to initialize WeChat Pay SDK. Payment features will be disabled. Reason: WeChat Pay configuration is incomplete or certificate files are missing.

[90mstderr[2m | src/tests/sellOrders.integration.test.ts[2m > [22m[2mSell Orders API
[22m[39mMetrics endpoint registered at /metrics

{"level":30,"time":1760782674891,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","req":{"method":"POST","url":"/api/sell-orders","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782674896,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","userId":1,"userRole":"STAFF","requiredRole":"STAFF","source":"db_lookup","msg":"Role check debug"}
{"level":30,"time":1760782674897,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","operatorId":1,"customerPhoneNumber":"13900139000","totalWeightKg":3.2,"unitPriceCents":250,"settlementType":"CASH","action":"CREATE_SELL_ORDER","msg":"STAFF member creating sell order"}
{"level":30,"time":1760782674960,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","operatorId":1,"targetUserId":2,"orderId":1,"totalAmount":800,"action":"SELL_ORDER_CREATED","msg":"Sell order created successfully"}
{"level":30,"time":1760782674961,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","res":{"statusCode":201},"responseTime":70.19879999989644,"msg":"request completed"}
{"level":30,"time":1760782675830,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","req":{"method":"POST","url":"/api/sell-orders","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782675835,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","res":{"statusCode":403},"responseTime":5.718799999915063,"msg":"request completed"}
 [32m‚úì[39m src/tests/sellOrders.integration.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2716[2mms[22m[39m
   [33m[2m‚úì[22m[39m Sell Orders API[2m > [22mallows staff to create and complete a sell order [33m 939[2mms[22m[39m
   [33m[2m‚úì[22m[39m Sell Orders API[2m > [22mrejects non-staff callers [33m 890[2mms[22m[39m
   [33m[2m‚úì[22m[39m Sell Orders API[2m > [22mshould be rejected by database if a BULK_ACQUISITION item is created without a sourceOrderId [33m 671[2mms[22m[39m
[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Á°Æ‰øùÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãÂè™Êúâ‰∏Ä‰∏™‰ªªÂä°ÂÆû‰æãËÉΩËé∑ÂèñÂà∞Âêå‰∏Ä‰∏™Âí®ËØ¢ÈîÅ
[22m[39m[AdvisoryLock] Lock acquired for "test:concurrent-lock-verification". Running task.

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Á°Æ‰øùÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãÂè™Êúâ‰∏Ä‰∏™‰ªªÂä°ÂÆû‰æãËÉΩËé∑ÂèñÂà∞Âêå‰∏Ä‰∏™Âí®ËØ¢ÈîÅ
[22m[39m[AdvisoryLock] Could not acquire lock for "test:concurrent-lock-verification". Another instance is likely running.

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Á°Æ‰øùÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãÂè™Êúâ‰∏Ä‰∏™‰ªªÂä°ÂÆû‰æãËÉΩËé∑ÂèñÂà∞Âêå‰∏Ä‰∏™Âí®ËØ¢ÈîÅ
[22m[39m[AdvisoryLock] Could not acquire lock for "test:concurrent-lock-verification". Another instance is likely running.

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Á°Æ‰øùÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãÂè™Êúâ‰∏Ä‰∏™‰ªªÂä°ÂÆû‰æãËÉΩËé∑ÂèñÂà∞Âêå‰∏Ä‰∏™Âí®ËØ¢ÈîÅ
[22m[39m[AdvisoryLock] Could not acquire lock for "test:concurrent-lock-verification". Another instance is likely running.

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Á°Æ‰øùÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãÂè™Êúâ‰∏Ä‰∏™‰ªªÂä°ÂÆû‰æãËÉΩËé∑ÂèñÂà∞Âêå‰∏Ä‰∏™Âí®ËØ¢ÈîÅ
[22m[39m[AdvisoryLock] Could not acquire lock for "test:concurrent-lock-verification". Another instance is likely running.

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Á°Æ‰øùÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãÂè™Êúâ‰∏Ä‰∏™‰ªªÂä°ÂÆû‰æãËÉΩËé∑ÂèñÂà∞Âêå‰∏Ä‰∏™Âí®ËØ¢ÈîÅ
[22m[39m[AdvisoryLock] Could not acquire lock for "test:concurrent-lock-verification". Another instance is likely running.

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Á°Æ‰øùÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãÂè™Êúâ‰∏Ä‰∏™‰ªªÂä°ÂÆû‰æãËÉΩËé∑ÂèñÂà∞Âêå‰∏Ä‰∏™Âí®ËØ¢ÈîÅ
[22m[39m[AdvisoryLock] Could not acquire lock for "test:concurrent-lock-verification". Another instance is likely running.

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Á°Æ‰øùÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãÂè™Êúâ‰∏Ä‰∏™‰ªªÂä°ÂÆû‰æãËÉΩËé∑ÂèñÂà∞Âêå‰∏Ä‰∏™Âí®ËØ¢ÈîÅ
[22m[39m[AdvisoryLock] Could not acquire lock for "test:concurrent-lock-verification". Another instance is likely running.

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Á°Æ‰øùÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãÂè™Êúâ‰∏Ä‰∏™‰ªªÂä°ÂÆû‰æãËÉΩËé∑ÂèñÂà∞Âêå‰∏Ä‰∏™Âí®ËØ¢ÈîÅ
[22m[39m[AdvisoryLock] Could not acquire lock for "test:concurrent-lock-verification". Another instance is likely running.

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Á°Æ‰øùÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãÂè™Êúâ‰∏Ä‰∏™‰ªªÂä°ÂÆû‰æãËÉΩËé∑ÂèñÂà∞Âêå‰∏Ä‰∏™Âí®ËØ¢ÈîÅ
[22m[39m[AdvisoryLock] Could not acquire lock for "test:concurrent-lock-verification". Another instance is likely running.

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Á°Æ‰øùÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãÂè™Êúâ‰∏Ä‰∏™‰ªªÂä°ÂÆû‰æãËÉΩËé∑ÂèñÂà∞Âêå‰∏Ä‰∏™Âí®ËØ¢ÈîÅ
[22m[39m[AdvisoryLock] Lock released for "test:concurrent-lock-verification".

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•ÂÖÅËÆ∏‰∏çÂêåÈîÅÂêçÁöÑ‰ªªÂä°Âπ∂ÂèëÊâßË°å
[22m[39m[AdvisoryLock] Lock acquired for "test:lock-a". Running task.

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•ÂÖÅËÆ∏‰∏çÂêåÈîÅÂêçÁöÑ‰ªªÂä°Âπ∂ÂèëÊâßË°å
[22m[39m[AdvisoryLock] Lock acquired for "test:lock-b". Running task.

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•ÂÖÅËÆ∏‰∏çÂêåÈîÅÂêçÁöÑ‰ªªÂä°Âπ∂ÂèëÊâßË°å
[22m[39m[AdvisoryLock] Lock released for "test:lock-b".

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•ÂÖÅËÆ∏‰∏çÂêåÈîÅÂêçÁöÑ‰ªªÂä°Âπ∂ÂèëÊâßË°å
[22m[39m[AdvisoryLock] Lock released for "test:lock-a".

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Âú®‰ªªÂä°ÊäõÂá∫ÂºÇÂ∏∏Êó∂‰ªçÁÑ∂ÈáäÊîæÈîÅ
[22m[39m[AdvisoryLock] Lock acquired for "test:error-handling-lock". Running task.

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Âú®‰ªªÂä°ÊäõÂá∫ÂºÇÂ∏∏Êó∂‰ªçÁÑ∂ÈáäÊîæÈîÅ
[22m[39m[AdvisoryLock] Lock released for "test:error-handling-lock".

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Âú®‰ªªÂä°ÊäõÂá∫ÂºÇÂ∏∏Êó∂‰ªçÁÑ∂ÈáäÊîæÈîÅ
[22m[39m[AdvisoryLock] Lock acquired for "test:error-handling-lock". Running task.

[90mstdout[2m | src/tests/advisoryLock.integration.test.ts[2m > [22m[2mAdvisory Lock Concurrent Execution Tests[2m > [22m[2mÂ∫îËØ•Âú®‰ªªÂä°ÊäõÂá∫ÂºÇÂ∏∏Êó∂‰ªçÁÑ∂ÈáäÊîæÈîÅ
[22m[39m[AdvisoryLock] Lock released for "test:error-handling-lock".

 [32m‚úì[39m src/tests/advisoryLock.integration.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2138[2mms[22m[39m
   [33m[2m‚úì[22m[39m Advisory Lock Concurrent Execution Tests[2m > [22mÂ∫îËØ•Á°Æ‰øùÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãÂè™Êúâ‰∏Ä‰∏™‰ªªÂä°ÂÆû‰æãËÉΩËé∑ÂèñÂà∞Âêå‰∏Ä‰∏™Âí®ËØ¢ÈîÅ [33m 847[2mms[22m[39m
   [33m[2m‚úì[22m[39m Advisory Lock Concurrent Execution Tests[2m > [22mÂ∫îËØ•ÂÖÅËÆ∏‰∏çÂêåÈîÅÂêçÁöÑ‰ªªÂä°Âπ∂ÂèëÊâßË°å [33m 646[2mms[22m[39m
   [33m[2m‚úì[22m[39m Advisory Lock Concurrent Execution Tests[2m > [22mÂ∫îËØ•Âú®‰ªªÂä°ÊäõÂá∫ÂºÇÂ∏∏Êó∂‰ªçÁÑ∂ÈáäÊîæÈîÅ [33m 641[2mms[22m[39m
[90mstdout[2m | tests/integration/db/views/orderView.test.ts
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

 [32m‚úì[39m tests/integration/db/views/orderView.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2573[2mms[22m[39m
   [33m[2m‚úì[22m[39m db/views/orderView[2m > [22mreturns the expected public shape for orders with inventory items [33m 725[2mms[22m[39m
   [33m[2m‚úì[22m[39m db/views/orderView[2m > [22msupports includes with the same inventory shape [33m 834[2mms[22m[39m
   [33m[2m‚úì[22m[39m db/views/orderView[2m > [22mexposes only the base fields when using the basic selector [33m 1013[2mms[22m[39m
[90mstdout[2m | src/tests/acquisitions.integration.test.ts[2m > [22m[2mAcquisitions Allowlist API
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

[90mstderr[2m | src/tests/acquisitions.integration.test.ts[2m > [22m[2mAcquisitions Allowlist API
[22m[39m‚úÖ Test database URL set for worker 1: postgres://test:test@localhost...

[90mstderr[2m | src/tests/acquisitions.integration.test.ts[2m > [22m[2mAcquisitions Allowlist API
[22m[39m!!! WARNING: Failed to initialize WeChat Pay SDK. Payment features will be disabled. Reason: WeChat Pay configuration is incomplete or certificate files are missing.

[90mstderr[2m | src/tests/acquisitions.integration.test.ts[2m > [22m[2mAcquisitions Allowlist API
[22m[39mMetrics endpoint registered at /metrics

{"level":30,"time":1760782682324,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","req":{"method":"GET","url":"/api/acquisitions/check?isbn=9781234567897","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782682350,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-1","res":{"statusCode":200},"responseTime":26.129100000020117,"msg":"request completed"}
{"level":30,"time":1760782683203,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","req":{"method":"GET","url":"/api/acquisitions/check?isbn=9781234567898","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1760782683207,"pid":29592,"hostname":"LAPTOP-P2FCIAFQ","reqId":"req-2","res":{"statusCode":200},"responseTime":3.7601000000722706,"msg":"request completed"}
 [32m‚úì[39m src/tests/acquisitions.integration.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 1803[2mms[22m[39m
   [33m[2m‚úì[22m[39m Acquisitions Allowlist API[2m > [22mËøîÂõûÂèØÊî∂Ë¥≠ÁâàÊú¨ÂàóË°® [33m 883[2mms[22m[39m
   [33m[2m‚úì[22m[39m Acquisitions Allowlist API[2m > [22mÊü•ËØ¢ÈùûÁôΩÂêçÂçïISBNÊó∂ËøîÂõûÁ©∫Êï∞ÁªÑ [33m 759[2mms[22m[39m
[90mstdout[2m | src/tests/refund-recovery.integration.test.ts[2m > [22m[2mRefund Recovery Integration
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

[90mstderr[2m | src/tests/refund-recovery.integration.test.ts[2m > [22m[2mRefund Recovery Integration[2m > [22m[2mshould mark refund as FAILED after exceeding max attempts
[22m[39mFailed to process refund for out_trade_no: FAIL_1_1760782684904 Error: permanent failure
    at [90mC:\Users\wapadil\WeChatProjects\miniprogram-13\bookworm-backend\[39msrc\tests\refund-recovery.integration.test.ts:128:52
    at [90mfile:///C:/Users/wapadil/WeChatProjects/miniprogram-13/bookworm-backend/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

[90mstderr[2m | src/tests/refund-recovery.integration.test.ts[2m > [22m[2mRefund Recovery Integration[2m > [22m[2mshould mark refund as FAILED after exceeding max attempts
[22m[39mRefund permanently failed after 5 attempts for out_trade_no: FAIL_1_1760782684904

 [32m‚úì[39m src/tests/refund-recovery.integration.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 1836[2mms[22m[39m
   [33m[2m‚úì[22m[39m Refund Recovery Integration[2m > [22mshould resume processing refunds that are stuck in REFUND_PROCESSING [33m 906[2mms[22m[39m
   [33m[2m‚úì[22m[39m Refund Recovery Integration[2m > [22mshould mark refund as FAILED after exceeding max attempts [33m 924[2mms[22m[39m
[90mstdout[2m | tests/integration/db/views/inventoryView.test.ts
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

 [32m‚úì[39m tests/integration/db/views/inventoryView.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 1722[2mms[22m[39m
   [33m[2m‚úì[22m[39m db/views/inventoryView[2m > [22mreturns public inventory shape without internal fields [33m 1011[2mms[22m[39m
   [33m[2m‚úì[22m[39m db/views/inventoryView[2m > [22mincludes status for internal consumers via the basic selector [33m 710[2mms[22m[39m
[90mstdout[2m | src/tests/order-payment-amount.integration.test.ts[2m > [22m[2morder payment amount integrity
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

[90mstderr[2m | src/tests/order-payment-amount.integration.test.ts[2m > [22m[2morder payment amount integrity[2m > [22m[2mrejects payment params when stored total diverges from recalculated sum
[22m[39m{ orderId: [33m1[39m, storedAmount: [33m8001[39m, calculatedAmount: [33m8000[39m, userId: [33m1[39m } CRITICAL: Amount mismatch detected for order 1. This indicates data corruption!

 [32m‚úì[39m src/tests/order-payment-amount.integration.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 747[2mms[22m[39m
   [33m[2m‚úì[22m[39m order payment amount integrity[2m > [22mrejects payment params when stored total diverges from recalculated sum [33m 744[2mms[22m[39m
[90mstdout[2m | src/tests/order-expiration.integration.test.ts[2m > [22m[2mOrder Expiration Integration Tests
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

[90mstdout[2m | src/tests/order-expiration.integration.test.ts[2m > [22m[2mOrder Expiration Integration Tests[2m > [22m[2mshould cancel expired orders and release inventory
[22m[39mCreated test user ID: [33m1[39m
Created inventory item IDs: [ [33m1[39m, [33m2[39m ]

[90mstdout[2m | src/tests/order-expiration.integration.test.ts[2m > [22m[2mOrder Expiration Integration Tests[2m > [22m[2mshould cancel expired orders and release inventory
[22m[39mFound inventory items: [ { id: [33m1[39m, status: [32m'in_stock'[39m }, { id: [33m2[39m, status: [32m'in_stock'[39m } ]

[90mstdout[2m | src/tests/order-expiration.integration.test.ts[2m > [22m[2mOrder Expiration Integration Tests[2m > [22m[2mshould cancel expired orders and release inventory
[22m[39mAtomically cancelled 1 orders and released 2 items back to stock.

 [32m‚úì[39m src/tests/order-expiration.integration.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 776[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Expiration Integration Tests[2m > [22mshould cancel expired orders and release inventory [33m 772[2mms[22m[39m
[90mstdout[2m | src/tests/order-pagination.integration.test.ts[2m > [22m[2mOrder Cursor Pagination Integration
[22m[39mCreating new Prisma client for worker 1 with URL: postgres://test:test@localhost...

 [32m‚úì[39m src/tests/order-pagination.integration.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 876[2mms[22m[39m
   [33m[2m‚úì[22m[39m Order Cursor Pagination Integration[2m > [22mshould return first page with next cursor for subsequent fetch [33m 873[2mms[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Tests 1 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m src/tests/databaseRules.integration.test.ts[2m > [22mDatabase-level Business Rules[2m > [22mwithTxRetry[2m > [22mretries deterministically on serialization conflicts
[31m[1mAssertionError[22m: expected 'rejected' to be 'fulfilled' // Object.is equality[39m

Expected: [32m"[7mfulfill[27med"[39m
Received: [31m"[7mreject[27med"[39m

[36m [2m‚ùØ[22m src/tests/databaseRules.integration.test.ts:[2m56:34[22m[39m
    [90m 54| [39m      const [, retryResult] = await Promise.allSettled([lockingTransac‚Ä¶
    [90m 55| [39m
    [90m 56| [39m      [34mexpect[39m(retryResult[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m"fulfilled"[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m 57| [39m      [34mexpect[39m(attempts)[33m.[39m[34mtoBeGreaterThan[39m([34m1[39m)[33m;[39m
    [90m 58| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/1]‚éØ[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m18 passed[39m[22m[90m (19)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m115 passed[39m[22m[90m (116)[39m
[2m   Start at [22m 18:16:28
[2m   Duration [22m 101.07s[2m (transform 790ms, setup 1.28s, collect 905ms, tests 89.85s, environment 0ms, prepare 182ms)[22m

Tearing down all test containers...
All containers stopped.
