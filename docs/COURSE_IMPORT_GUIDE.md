# è¯¾ç¨‹å¯¼å…¥æŒ‡å— (Course Import Guide)

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•é€šè¿‡ç®¡ç† API å¯¼å…¥ Bookworm å¤ä¹ ç³»ç»Ÿçš„è¯¾ç¨‹å†…å®¹ã€‚

> **âš  é‡è¦å˜æ›´è¯´æ˜**
> æ—§ç‰ˆæ–‡æ¡£æè¿°çš„ "ZIP æ–‡ä»¶ä¸Šä¼ " æ¥å£å·²åºŸå¼ƒã€‚å½“å‰ç³»ç»Ÿä»…æ”¯æŒ **JSON æ ¼å¼** çš„ API å¯¼å…¥ã€‚
> æœ¬é¡¹ç›®å·²å†…ç½®ä¸“ç”¨å®¢æˆ·ç«¯å·¥å…· `scripts/import_course_client.js` æ¥å¤„ç†æœ¬åœ°æ–‡ä»¶åˆ° API çš„è½¬æ¢ã€‚

---

## ç›®å½•
1. [æ¥å£è§„èŒƒ](#1-æ¥å£è§„èŒƒ)
2. [æ•°æ®ç»“æ„è¯¦è§£](#2-æ•°æ®ç»“æ„è¯¦è§£)
3. [å¯¼å…¥ç­–ç•¥](#3-å¯¼å…¥ç­–ç•¥)
4. [æ–‡ä»¶åˆ›ä½œè§„èŒƒ](#4-æ–‡ä»¶åˆ›ä½œè§„èŒƒ)
5. [å®Œæ•´ç¤ºä¾‹ï¼šé«˜ç­‰æ•°å­¦ (MA101)](#5-å®Œæ•´ç¤ºä¾‹é«˜ç­‰æ•°å­¦-ma101)
6. [å®¢æˆ·ç«¯è¾…åŠ©å·¥å…·](#6-å®¢æˆ·ç«¯è¾…åŠ©å·¥å…·)

---

## 1. æ¥å£è§„èŒƒ

æ‰€æœ‰çš„è¯¾ç¨‹å¯¼å…¥æ“ä½œéƒ½é€šè¿‡å•ä¸€çš„ POST æ¥å£å®Œæˆã€‚

- **æ¥å£åœ°å€**: `POST /api/study/admin/import`
- **æƒé™è¦æ±‚**: ä»…é™ç®¡ç†å‘˜ (`STAFF` è§’è‰²)
- **Content-Type**: `application/json`

### é‰´æƒ
éœ€è¦åœ¨ Request Header ä¸­æºå¸¦ Bearer Tokenï¼š
```http
Authorization: Bearer <YOUR_JWT_TOKEN>
```

---

## 2. æ•°æ®ç»“æ„è¯¦è§£

è¯·æ±‚ä½“å¿…é¡»ç¬¦åˆä»¥ä¸‹ JSON ç»“æ„ï¼š

```json
{
  "manifest": { ... },
  "units": [ ... ],
  "cards": {
    "unit_key_1": [ ... ],
    "unit_key_2": [ ... ]
  },
  "questions": {
    "unit_key_1": [ ... ]
  },
  "cheatsheets": [ ... ],
  "options": {
    "dryRun": false,
    "overwriteContent": true,
    "publishOnImport": true
  }
}
```

### 2.1 Manifest (è¯¾ç¨‹å…ƒæ•°æ®)
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `courseKey` | string | âœ… | è¯¾ç¨‹å”¯ä¸€æ ‡è¯†ï¼Œå»ºè®®å¤§å†™ (e.g. `MA101`) |
| `title` | string | âœ… | è¯¾ç¨‹æ˜¾ç¤ºæ ‡é¢˜ |
| `contentVersion` | number | âœ… | ç‰ˆæœ¬å· (æ­£æ•´æ•°)ï¼Œç”¨äºç‰ˆæœ¬æ§åˆ¶ |
| `description` | string | âŒ | è¯¾ç¨‹ç®€ä»‹ |
| `locale` | string | âŒ | è¯­è¨€ä»£ç  (é»˜è®¤ `zh-CN`) |

### 2.2 Units (ç« èŠ‚åˆ—è¡¨)
æ•°ç»„ï¼Œå®šä¹‰è¯¾ç¨‹çš„ç« èŠ‚ç»“æ„ã€‚
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `unitKey` | string | ç« èŠ‚å”¯ä¸€æ ‡è¯† (å»ºè®®ä½¿ç”¨æœ‰æ„ä¹‰çš„è‹±æ–‡å•è¯ e.g. `limit`, `derivative`) |
| `title` | string | ç« èŠ‚æ ‡é¢˜ |
| `orderIndex` | number | æ’åºç´¢å¼• |

### 2.3 Cards (é—ªå¡)
å¯¹è±¡ Mapï¼Œé”®ä¸º `unitKey`ï¼Œå€¼ä¸ºè¯¥ç« èŠ‚çš„å¡ç‰‡æ•°ç»„ã€‚
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `contentId` | string | å…¨å±€å”¯ä¸€çš„å¡ç‰‡ID (å»ºè®® `course-unit-seq`) |
| `front` | string | æ­£é¢å†…å®¹ (æ”¯æŒ Markdown/LaTeX) |
| `back` | string | èƒŒé¢å†…å®¹ (æ”¯æŒ Markdown/LaTeX) |
| `tags` | string | æ ‡ç­¾ (é€—å·åˆ†éš”) |
| `difficulty` | number | éš¾åº¦ç³»æ•° (1-5) |

### 2.4 Questions (é¢˜ç›®)
å¯¹è±¡ Mapï¼Œé”®ä¸º `unitKey`ï¼Œå€¼ä¸ºè¯¥ç« èŠ‚çš„é¢˜ç›®æ•°ç»„ã€‚
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `contentId` | string | é¢˜ç›®ID |
| `questionType` | enum | `SINGLE_CHOICE`, `MULTI_CHOICE`, `TRUE_FALSE`, `FILL_BLANK` |
| `stem` | string | é¢˜å¹² |
| `options` | string[] | é€‰é¡¹æ•°ç»„ (ä»…é€‰æ‹©é¢˜) |
| `answer` | string | ç­”æ¡ˆå­—ç¬¦ä¸² (å¤šé€‰ä¸ºJSON arrayæˆ–ç”¨`\|`åˆ†éš”) |
| `explanation` | string | ç®€çŸ­è§£æ |

### 2.5 Cheatsheets (æ€¥æ•‘åŒ…)
èµ„æºåˆ—è¡¨ã€‚
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `title` | string | èµ„æºæ ‡é¢˜ |
| `assetType` | enum | `pdf` æˆ– `image` |
| `url` | string | èµ„æºä¸‹è½½é“¾æ¥ (HTTPS) |
| `unitKey` | string | å…³è”çš„ç« èŠ‚ Key (å¯é€‰) |

> **ğŸ–¼ å…³äºå›¾ç‰‡èµ„æº**: ç›®å‰å¯¼å…¥ API **ä¸å¤„ç†** æ–‡ä»¶çš„äºŒè¿›åˆ¶ä¸Šä¼ ã€‚å¦‚æœæ€¥æ•‘åŒ…æ˜¯ PDF æˆ–å›¾ç‰‡ï¼Œæ‚¨å¿…é¡»å…ˆå°†å…¶ä¸Šä¼ åˆ°å¤–éƒ¨å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚é˜¿é‡Œäº‘ OSS æˆ– CDNï¼‰ï¼Œç„¶ååœ¨ content æˆ– URL å­—æ®µä¸­å¼•ç”¨è¯¥å…¬ç½‘ URLã€‚

---

## 3. å¯¼å…¥ç­–ç•¥ (Options)

åœ¨ `options` å­—æ®µä¸­æ§åˆ¶å¯¼å…¥è¡Œä¸ºï¼š

- **`dryRun`** (boolean): é»˜è®¤ `false`ã€‚å¦‚æœæ˜¯ `true`ï¼ŒæœåŠ¡å™¨ä»…è¿›è¡Œæ•°æ®éªŒè¯ï¼Œä¸å†™å…¥æ•°æ®åº“ã€‚ç”¨äºæµ‹è¯•æ•°æ®æ ¼å¼ã€‚
- **`overwriteContent`** (boolean): é»˜è®¤ `false`ã€‚
  - `false`: å¦‚æœæ£€æµ‹åˆ°åŒç‰ˆæœ¬è¯¾ç¨‹å·²å­˜åœ¨ï¼ŒæŠ¥é”™æˆ–è·³è¿‡ã€‚
  - `true`: å¼ºåˆ¶è¦†ç›–ç°æœ‰çš„è¯¾ç¨‹å†…å®¹ï¼ˆæ›´æ–°æ ‡é¢˜ã€å¡ç‰‡ã€é¢˜ç›®ç­‰ï¼‰ã€‚
- **`publishOnImport`** (boolean): é»˜è®¤ `false`ã€‚å¯¼å…¥æˆåŠŸåæ˜¯å¦ç›´æ¥å°†è¯¾ç¨‹çŠ¶æ€è®¾ä¸º `PUBLISHED`ã€‚

---

## 4. æ–‡ä»¶åˆ›ä½œè§„èŒƒ

å°½ç®¡ API éœ€è¦ JSONï¼Œä½†æ¨èåœ¨æœ¬åœ°ä»¥ **æ–‡ä»¶** å½¢å¼ç®¡ç†è¯¾ç¨‹å†…å®¹ï¼Œç„¶åä½¿ç”¨è„šæœ¬è½¬æ¢ã€‚

### ç›®å½•ç»“æ„æ¨è
```
course_code/
â”œâ”€â”€ manifest.json       # è¯¾ç¨‹å…ƒæ•°æ®
â”œâ”€â”€ units.json          # ç« èŠ‚å®šä¹‰
â”œâ”€â”€ cards/              # å­˜æ”¾ .tsv æ–‡ä»¶
â”‚   â”œâ”€â”€ [unitKey].tsv
â”‚   â””â”€â”€ ...
â””â”€â”€ questions/          # å­˜æ”¾ .gift æ–‡ä»¶
    â”œâ”€â”€ [unitKey].gift
    â””â”€â”€ ...
```

### æ ¼å¼æ ‡å‡†
1. **Cards (.tsv)**: åˆ¶è¡¨ç¬¦åˆ†éš”ï¼Œå¿…é¡»åŒ…å« `contentId`, `front`, `back` åˆ—ã€‚
2. **Questions (.gift)**: ç®€åŒ–ç‰ˆ GIFT æ ¼å¼ã€‚
   - å•é€‰: `::ID:: é¢˜å¹² { =æ­£ç¡® ~é”™è¯¯ }`
   - åˆ¤æ–­: `::ID:: é¢˜å¹² {T}`
   - å¡«ç©º: `::ID:: é¢˜å¹² {=ç­”æ¡ˆ}`

---

## 5. å®Œæ•´ç¤ºä¾‹ï¼šé«˜ç­‰æ•°å­¦ (MA101)

ä»¥ä¸‹å±•ç¤ºäº†é¡¹ç›®ä¸­å®é™…ä½¿ç”¨çš„ `MA101 é«˜ç­‰æ•°å­¦` è¯¾ç¨‹åŒ…çš„æ–‡ä»¶ç»“æ„å’Œå†…å®¹ã€‚

### 5.1 ç›®å½•ç»“æ„
```
MA101/
â”œâ”€â”€ manifest.json
â”œâ”€â”€ units.json
â”œâ”€â”€ cards/
â”‚   â”œâ”€â”€ limit.tsv        (å¯¹åº” unitKey: limit)
â”‚   â””â”€â”€ derivative.tsv   (å¯¹åº” unitKey: derivative)
â””â”€â”€ questions/
    â”œâ”€â”€ limit.gift
    â””â”€â”€ derivative.gift
```

### 5.2 manifest.json
```json
{
  "courseKey": "MA101",
  "title": "é«˜ç­‰æ•°å­¦ï¼ˆä¸Šï¼‰",
  "description": "å¤§å­¦ä¸€å¹´çº§é«˜ç­‰æ•°å­¦æ ¸å¿ƒå†…å®¹ï¼Œæ¶µç›–æé™ã€å¯¼æ•°ã€ç§¯åˆ†ç­‰åŸºç¡€çŸ¥è¯†ç‚¹ã€‚",
  "contentVersion": 1,
  "locale": "zh-CN"
}
```

### 5.3 units.json
```json
[
  { "unitKey": "limit", "title": "ç¬¬ä¸€ç«  æé™", "orderIndex": 1 },
  { "unitKey": "derivative", "title": "ç¬¬äºŒç«  å¯¼æ•°ä¸å¾®åˆ†", "orderIndex": 2 }
]
```

### 5.4 cards/limit.tsv
*æ³¨æ„ï¼šç¬¬ä¸€è¡Œå¿…é¡»æ˜¯è¡¨å¤´ï¼Œåˆ—åä¸åŒºåˆ†å¤§å°å†™ã€‚*

```tsv
contentId	difficulty	front	back
MA101-limit-001	1	æé™çš„ $\varepsilon$-$\delta$ å®šä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ	å¯¹äºä»»æ„ç»™å®šçš„ $\varepsilon > 0$ï¼Œæ€»å­˜åœ¨ $\delta > 0$ï¼Œä½¿å¾—å½“ $0 < |x - x_0| < \delta$ æ—¶ï¼Œæ’æœ‰ $|f(x) - A| < \varepsilon$ã€‚
MA101-limit-002	1	æé™å”¯ä¸€æ€§å®šç†å†…å®¹ï¼Ÿ	å¦‚æœæ•°åˆ— $\{x_n\}$ æ”¶æ•›ï¼Œé‚£ä¹ˆå®ƒçš„æé™æ˜¯å”¯ä¸€çš„ã€‚
MA101-limit-004	2	å¤¹é€¼å‡†åˆ™ï¼ˆSqueeze Theoremï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ	è‹¥åœ¨æŸå»å¿ƒé‚»åŸŸå†… $g(x) \le f(x) \le h(x)$ï¼Œä¸” $\lim g(x) = \lim h(x) = A$ï¼Œåˆ™ $\lim f(x) = A$ã€‚
```

### 5.5 questions/limit.gift
*æ³¨æ„ï¼šGIFT æ ¼å¼ä¸­ `::` åŒ…è£¹çš„æ˜¯é¢˜ç›®IDã€‚*

```text
// å•é€‰é¢˜
::MA101-limit-Q001:: $\lim_{x \to 0} \frac{\sin x}{x}$ çš„å€¼æ˜¯ï¼Ÿ {
  =1
  ~0
  ~ä¸å­˜åœ¨
  ~\infty
}

// å¡«ç©ºé¢˜
::MA101-limit-Q004:: $\lim_{x \to \infty} \left(1 + \frac{1}{x}\right)^x$ = ____ {=e}

// åˆ¤æ–­é¢˜
::MA101-limit-Q005:: è‹¥å‡½æ•°åœ¨æŸç‚¹è¿ç»­ï¼Œåˆ™è¯¥å‡½æ•°åœ¨è¯¥ç‚¹å¿…å¯å¯¼ã€‚ {F}
```

---

## 6. å®¢æˆ·ç«¯è¾…åŠ©å·¥å…·

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªä¸“ç”¨çš„ Node.js è„šæœ¬ï¼š`bookworm-backend/scripts/import_course_client.js`ã€‚

### 6.1 å‰ç½®æ¡ä»¶
1. å®‰è£… Node.js (v18+)
2. è·å– **Staff Token**
   - ç™»å½•åå°ç®¡ç†ç³»ç»Ÿï¼ŒæŸ¥çœ‹ Network é¢æ¿è·å– Header ä¸­çš„ Bearer Token
   - æˆ–è€…ä½¿ç”¨å¾®ä¿¡ç™»å½•æ¥å£ `POST /api/auth/login` äº¤æ¢ Token

### 6.2 ä½¿ç”¨æ–¹æ³•

è„šæœ¬ä½äºåç«¯ä»“åº“çš„ scripts ç›®å½•ä¸‹ï¼š

```bash
cd bookworm-backend/scripts
```

**åŸºæœ¬ç”¨æ³•**:
```bash
# å¯¼å…¥è¯¾ç¨‹ (éœ€è¦ Token)
node import_course_client.js --token "ey..." ../../courses/MA101
```

**é«˜çº§é€‰é¡¹**:

| å‚æ•° | è¯´æ˜ |
|------|------|
| `--dry-run` | ä»…éªŒè¯æ•°æ®æ ¼å¼ï¼Œä¸è¿›è¡Œå®é™…å¯¼å…¥ |
| `--force` | å¼ºåˆ¶è¦†ç›–ç°æœ‰è¯¾ç¨‹å†…å®¹ |
| `--publish` | å¯¼å…¥åç›´æ¥å‘å¸ƒ |
| `--api <url>` | æŒ‡å®š API åœ°å€ (é»˜è®¤ http://localhost:8080) |

**ç¯å¢ƒå˜é‡**:
ä¸ºäº†é¿å…æ¯æ¬¡å¤åˆ¶ç²˜è´´ Tokenï¼Œä½ å¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
# Windows PowerShell
$env:BOOKWORM_TOKEN="ey..."
node import_course_client.js ../../my_course_dir

# Linux/Mac
export BOOKWORM_TOKEN="ey..."
node import_course_client.js ../../my_course_dir
```
