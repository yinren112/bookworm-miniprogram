# 学习模块技术债务追踪清单

**创建日期**: 2026-01-31  
**关联报告**: [study-module-audit-2026-01-31.md](./study-module-audit-2026-01-31.md)

---

## 【P0 - 阻断发布】必须立即修复

### PRISMA-001: Schema 关系缺失
- [ ] 添加 `StudyCard` ↔ `UserStarredItem` 关系
- [ ] 添加数据库约束 `chk_content_xor_question`
- [ ] 生成迁移脚本
- [ ] 运行集成测试验证
- **负责人**: 待分配
- **截止**: 2026-02-07

### DB-001: 唯一约束逻辑漏洞
- [ ] 编写 SQL 修复脚本
- [ ] 检查现有数据一致性
- [ ] 添加应用层校验
- **负责人**: 待分配
- **截止**: 2026-02-07

### FE-001: 星标竞态条件
- [ ] 添加防抖机制 (500ms)
- [ ] 实现重试队列 (最大 3 次)
- [ ] 页面卸载时批量提交
- [ ] 添加冲突检测 UI
- **负责人**: 待分配
- **截止**: 2026-02-10

### FE-002: 定时器内存泄漏
- [ ] 实现 `WeakMap` 页面跟踪
- [ ] 添加自动清理机制
- [ ] 内存占用测试 (Chrome DevTools)
- **负责人**: 待分配
- **截止**: 2026-02-10

### BE-001: SQL 注入风险
- [ ] 添加 `contentId` 格式校验 (zod schema)
- [ ] 检查所有用户输入点
- [ ] 安全测试 (渗透测试)
- **负责人**: 待分配
- **截止**: 2026-02-10

---

## 【P1 - 高优先级】2周内修复

### FE-003: 缓存污染
- [ ] 添加失败计数器
- [ ] 3 次失败后强制刷新
- [ ] 添加缓存健康检查日志
- **负责人**: 待分配
- **截止**: 2026-02-14

### FE-004: 时间计算精度
- [ ] 替换为 `Intl.DateTimeFormat`
- [ ] 测试夏令时边界
- [ ] 回归测试所有时间相关功能
- **负责人**: 待分配
- **截止**: 2026-02-14

### FE-005: 存储空间爆炸
- [ ] 实现数据压缩 (只存 contentId)
- [ ] 恢复时重新拉取机制
- [ ] 存储大小监控
- **负责人**: 待分配
- **截止**: 2026-02-14

---

## 【P2 - 中优先级】1个月内修复

### FE-006: 死循环风险
- [ ] 架构审查所有订阅点
- [ ] 添加循环检测机制
- [ ] 设置更新深度限制
- **负责人**: 待分配
- **截止**: 2026-03-01

### FE-007: 重复提交竞态
- [ ] 实现原子锁 (页面级)
- [ ] 添加防抖装饰器
- [ ] 压力测试
- **负责人**: 待分配
- **截止**: 2026-03-01

### API-001: API 设计不一致
- [ ] 整理所有 course 标识方式
- [ ] 设计统一方案
- [ ] 编写迁移计划 (向后兼容)
- **负责人**: 待分配
- **截止**: 2026-03-01

---

## 【P3 - 低优先级】技术债逐步还

### FE-008: 疲劳检测增强
- [ ] 分析答题正确率趋势
- [ ] 添加操作速度检测
- [ ] 时间段权重调整
- **负责人**: 待分配
- **截止**: 待定

### BE-002: 权限控制集中化
- [ ] 提取 `resolveCourseIds` 为 preHandler
- [ ] 重构所有路由
- [ ] 性能测试对比
- **负责人**: 待分配
- **截止**: 待定

---

## 【建议项】长期改进

### 文档改进
- [ ] 补充 Schema JSDoc 注释
- [ ] 编写 API 设计规范文档
- [ ] 更新 AGENTS.md 学习模块 SOP

### 配置优化
- [ ] 将硬编码参数移至配置表
- [ ] 实现 A/B 测试框架
- [ ] 添加配置热更新

### 监控增强
- [ ] 添加星标操作成功率监控
- [ ] 添加会话恢复成功率监控
- [ ] 添加缓存命中率监控

---

## 【验证清单】

每项修复完成后必须勾选：

- [ ] 代码审查通过 (PR Review)
- [ ] 单元测试覆盖新增代码
- [ ] 集成测试通过
- [ ] 手动测试验证场景
- [ ] 监控指标正常
- [ ] 无破坏性变更 (向后兼容)
- [ ] 文档已更新

---

## 【指标追踪】

| 指标 | 当前值 | 目标值 | 监控方式 |
|------|--------|--------|----------|
| 星标操作失败率 | 未知 | < 0.1% | 日志分析 |
| 会话恢复成功率 | 未知 | > 99% | 埋点统计 |
| 内存泄漏增长率 | 未知 | < 5MB/小时 | 真机测试 |
| 缓存命中率 | 未知 | > 80% | 日志分析 |
| API 平均响应时间 | 未知 | < 200ms | 服务端监控 |

---

**更新日志**:

- 2026-01-31: 初始版本创建，标记 5 个 P0 问题
- 待更新: 修复进度追踪

**维护者**: 待指定技术负责人
