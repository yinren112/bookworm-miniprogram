<!-- subpackages/review/pages/course/index.wxml -->
<!-- è¯¾ç¨‹è¯¦æƒ…é¡µ -->
<view class="container">
  <!-- è¯¾ç¨‹å¤´éƒ¨ -->
  <view class="course-header clay-card" wx:if="{{course}}">
    <text class="course-title">{{course.title}}</text>
    <text class="course-desc">{{course.description || 'æš‚æ— ç®€ä»‹'}}</text>
    <view class="course-meta">
      <view class="meta-item">
        <text class="meta-value">{{course.totalCards || 0}}</text>
        <text class="meta-label">å¡ç‰‡æ€»æ•°</text>
      </view>
      <!-- divider removed -->
      <view class="meta-item">
        <text class="meta-value">{{course.units.length || 0}}</text>
        <text class="meta-label">ç« èŠ‚æ•°</text>
      </view>
      <!-- divider removed -->
      <view class="meta-item">
        <text class="meta-value">{{course.enrollment ? 'å·²æ³¨å†Œ' : 'æœªæ³¨å†Œ'}}</text>
        <text class="meta-label">çŠ¶æ€</text>
      </view>
    </view>
  </view>
  <!-- ä»Šæ—¥é˜Ÿåˆ— -->
  <view class="queue-section clay-card" wx:if="{{course && course.enrollment && todaySummary}}">
    <view class="queue-header">
      <text class="queue-title">ä»Šæ—¥å¤ä¹ </text>
    </view>
    <view class="queue-stats">
      <view class="queue-stat">
        <text class="queue-number pending">{{todaySummary.dueCards || 0}}</text>
        <text class="queue-label">å¾…å¤ä¹ </text>
      </view>
      <view class="queue-stat">
        <text class="queue-number new">{{todaySummary.newCards || 0}}</text>
        <text class="queue-label">æ–°å¡ç‰‡</text>
      </view>
      <view class="queue-stat">
        <text class="queue-number done">{{todaySummary.reviewedToday || 0}}</text>
        <text class="queue-label">å·²å®Œæˆ</text>
      </view>
    </view>
    <button class="start-btn clay-btn-primary" bindtap="startReview" wx:if="{{todaySummary.dueCards > 0 || todaySummary.newCards > 0}}">
      å¼€å§‹å¤ä¹ 
    </button>
  </view>
  <!-- æ³¨å†ŒæŒ‰é’® -->
  <view class="enroll-section" wx:if="{{course && !course.enrollment && !loading}}">
    <button class="enroll-btn clay-btn-primary" bindtap="enrollCourse">æ³¨å†Œè¯¾ç¨‹</button>
  </view>
  <!-- å­¦ä¹ å·¥å…·æ  -->
  <view class="tool-bar clay-card" wx:if="{{course && course.enrollment}}">
    <view class="tool-item" bindtap="startAllFlashcard">
      <image class="tool-icon-img" src="/images/icons/clay_flashcards.png" mode="aspectFit" wx:if="{{hasIcons}}" />
      <text class="tool-icon" wx:else>ğŸ“š</text>
      <text class="tool-label">èƒŒå¡</text>
    </view>
    <!-- divider removed -->
    <view class="tool-item" bindtap="startAllQuiz">
      <image class="tool-icon-img" src="/images/icons/clay_quiz.png" mode="aspectFit" wx:if="{{hasIcons}}" />
      <text class="tool-icon" wx:else>ğŸ“</text>
      <text class="tool-label">åˆ·é¢˜</text>
    </view>
    <!-- divider removed -->
    <view class="tool-item" bindtap="goToCheatsheet">
      <image class="tool-icon-img" src="/images/icons/clay_cheatsheet.png" mode="aspectFit" wx:if="{{hasIcons}}" />
      <text class="tool-icon" wx:else>ğŸ“„</text>
      <text class="tool-label">æ€¥æ•‘åŒ…</text>
    </view>
  </view>
  <!-- ç« èŠ‚ç›®å½• -->
  <view class="section" wx:if="{{course}}">
    <view class="section-header">
      <text class="section-title">ç« èŠ‚ç›®å½•</text>
    </view>
    <view class="unit-list">
      <view class="unit-item clay-card clickable" wx:for="{{course.units}}" wx:key="id" bindtap="goToUnit" data-unit-id="{{item.id}}">
        <view class="unit-main">
          <view class="unit-order">
            <text class="order-text">
              {{item.orderIndex < 10 ? '0' + item.orderIndex : item.orderIndex}}
            </text>
          </view>
          <view class="unit-info">
            <text class="unit-title">{{item.title}}</text>
            <view class="unit-stats">
              <text class="unit-cards">{{item.cardCount || 0}} å¡ç‰‡</text>
            </view>
          </view>
        </view>
      </view>
      <view class="empty-state" wx:if="{{course.units.length === 0}}">
        <text class="empty-text">æš‚æ— ç« èŠ‚</text>
      </view>
    </view>
  </view>
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:if="{{!loading && !course}}">
    <text class="error-text">è¯¾ç¨‹ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥</text>
    <button class="retry-btn" bindtap="loadCourse">é‡è¯•</button>
  </view>
</view>
