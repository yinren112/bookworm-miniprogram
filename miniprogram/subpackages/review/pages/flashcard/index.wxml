<!-- subpackages/review/pages/flashcard/index.wxml -->
<!-- 卡片复习页 -->
<wxs src="../../utils/swipe-gesture.wxs" module="gesture" />
<view class="container">
  <!-- 进度条 -->
  <view class="progress-bar">
    <view class="progress-fill" style="width: {{progressPercent}}%"></view>
  </view>
  <view class="progress-text">
    <text>{{currentIndex + 1}} / {{cardsLength}}</text>
  </view>
  <!-- 卡片区域 -->
  <view class="card-wrapper" wx:if="{{!loading && currentCard}}">
    <!-- Star Button (Pinned to wrapper) -->
    <view class="star-btn {{isStarred ? 'starred' : ''}}" catchtap="toggleStar">
      <text class="star-icon">{{isStarred ? '★' : '☆'}}</text>
    </view>
    <!-- Card Container with WXS Swipe Gestures -->
    <view id="swipe-card" class="card-container {{isFlipped ? 'flipped' : ''}}" data-screen-width="{{screenWidth}}" bindtap="flipCard" bindtouchstart="{{gesture.touchStart}}" bindtouchmove="{{gesture.touchMove}}" bindtouchend="{{gesture.touchEnd}}">
      <!-- 正面 -->
      <view class="card card-front clay-card">
        <view class="card-label">Q</view>
        <view class="card-content">
          <mp-html content="{{currentCard.front}}" markdown="{{true}}" />
        </view>
        <view class="card-hint">
          <text>轻触翻牌</text>
        </view>
      </view>
      <!-- 背面 -->
      <view class="card card-back clay-card">
        <view class="card-label">A</view>
        <view class="card-content">
          <mp-html content="{{currentCard.back}}" markdown="{{true}}" />
        </view>
      </view>
      <!-- 4档 Swipe Indicators -->
      <view id="indicator-left-light" class="swipe-indicator fuzzy-overlay">
        <text>有点模糊</text>
      </view>
      <view id="indicator-left-heavy" class="swipe-indicator forgot-overlay">
        <text>想不起来</text>
      </view>
      <view id="indicator-right-light" class="swipe-indicator knew-overlay">
        <text>记住了</text>
      </view>
      <view id="indicator-right-heavy" class="swipe-indicator perfect-overlay">
        <text>完全掌握</text>
      </view>
    </view>
  </view>
  <!-- 反馈按钮 -->
  <!-- 反馈按钮 (Bottom Golden Zone) -->
  <view class="feedback-zone" wx:if="{{!loading && currentCard && isFlipped}}">
    <view class="feedback-buttons">
      <button class="feedback-btn forgot" bindtap="submitFeedback" data-rating="FORGOT">
        <text class="btn-emoji"></text>
        <text class="btn-label">想不起来</text>
      </button>
      <button class="feedback-btn fuzzy" bindtap="submitFeedback" data-rating="FUZZY">
        <text class="btn-emoji"></text>
        <text class="btn-label">有点模糊</text>
      </button>
      <button class="feedback-btn knew" bindtap="submitFeedback" data-rating="KNEW">
        <text class="btn-emoji"></text>
        <text class="btn-label">记住了</text>
      </button>
      <button class="feedback-btn perfect" bindtap="submitFeedback" data-rating="PERFECT">
        <text class="btn-emoji"></text>
        <text class="btn-label">完全掌握</text>
      </button>
    </view>
  </view>
  <!-- 翻转提示 -->
  <view class="flip-hint" wx:if="{{!loading && currentCard && !isFlipped}}">
    <text>点击卡片查看答案</text>
  </view>
  <!-- 纠错按钮 -->
  <view class="report-btn-wrapper" wx:if="{{!loading && currentCard}}">
    <view class="report-btn" bindtap="openReportModal">
      <text>发现问题？帮我们改进</text>
    </view>
  </view>
  <!-- 加载状态 -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">正在加载知识卡片...</text>
  </view>
  <!-- 完成状态 -->
  <view class="complete-state" wx:if="{{!loading && completed}}">
    <view class=\"complete-icon\"></view>", "StartLine": 90, "TargetContent": "    <view class=\"complete-icon\">\ud83c\udf8a</view>
    <text class="complete-title">太棒了!</text>
    <text class="complete-desc">这一轮你完成了！</text>
    <view class="complete-stats">
      <text>攻克了 {{cardsLength}} 张卡片</text>
    </view>
    <button class="back-btn" bindtap="goBack">返回课程</button>
  </view>
  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && !completed && cardsLength === 0}}">
    <text class="empty-text">今天的卡片都复习完了，休息一下吧</text>
    <button class="back-btn" bindtap="goBack">返回课程</button>
  </view>
  <!-- 纠错弹窗 -->
  <report-issue visible="{{showReportModal}}" courseKey="{{courseKey}}" cardId="{{currentCard.id}}" bind:close="closeReportModal" bind:success="onReportSuccess" />
</view>