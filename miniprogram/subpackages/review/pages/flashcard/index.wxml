<!-- subpackages/review/pages/flashcard/index.wxml -->
<!-- 卡片复习页 -->
<view class="container">
  <!-- 进度条 -->
  <view class="progress-bar">
    <view class="progress-fill" style="width: {{progressPercent}}%"></view>
  </view>
  <view class="progress-text">
    <text>{{currentIndex + 1}} / {{cards.length}}</text>
  </view>
  <!-- 卡片区域 -->
  <view class="card-wrapper" wx:if="{{!loading && currentCard}}">
    <!-- Star Button (Pinned to wrapper) -->
    <view class="star-btn {{isStarred ? 'starred' : ''}}" catchtap="toggleStar">
      <text class="star-icon">{{isStarred ? '★' : '☆'}}</text>
    </view>
    <!-- Card Container with Swipe Gestures and Style Binding -->
    <!-- Note: class 'flipped' is still useful for CSS-only flips, but we also bind 'style' for swipe transforms -->
    <view class="card-container {{isFlipped ? 'flipped' : ''}} {{swipeClass}}" style="{{cardStyle}}" bindtap="flipCard" bindtouchstart="touchStart" bindtouchmove="touchMove" bindtouchend="touchEnd">
      <!-- 正面 -->
      <view class="card card-front clay-card">
        <view class="card-label">问题</view>
        <view class="card-content">
          <mp-html content="{{currentCard.front}}" markdown="{{true}}" />
        </view>
        <view class="card-hint">
          <text>点击翻转 / 左右滑动</text>
        </view>
      </view>
      <!-- 背面 -->
      <view class="card card-back clay-card">
        <view class="card-label">答案</view>
        <view class="card-content">
          <mp-html content="{{currentCard.back}}" markdown="{{true}}" />
        </view>
      </view>
      <!-- Swipe Indicators (Overlay) -->
      <view class="swipe-indicator forgot-overlay" style="opacity: {{swipeOpacityForgot}}">
        <text>😓 忘了</text>
      </view>
      <view class="swipe-indicator knew-overlay" style="opacity: {{swipeOpacityKnew}}">
        <text>😊 记得</text>
      </view>
    </view>
  </view>
  <!-- 反馈按钮 -->
  <!-- 反馈按钮 (Bottom Golden Zone) -->
  <view class="feedback-zone" wx:if="{{!loading && currentCard && isFlipped}}">
    <view class="feedback-buttons">
      <button class="feedback-btn forgot" bindtap="submitFeedback" data-rating="FORGOT">
        <text class="btn-emoji">😓</text>
        <text class="btn-label">忘了</text>
      </button>
      <button class="feedback-btn fuzzy" bindtap="submitFeedback" data-rating="FUZZY">
        <text class="btn-emoji">🤔</text>
        <text class="btn-label">模糊</text>
      </button>
      <button class="feedback-btn knew" bindtap="submitFeedback" data-rating="KNEW">
        <text class="btn-emoji">😊</text>
        <text class="btn-label">记得</text>
      </button>
      <button class="feedback-btn perfect" bindtap="submitFeedback" data-rating="PERFECT">
        <text class="btn-emoji">🎉</text>
        <text class="btn-label">完美</text>
      </button>
    </view>
  </view>
  <!-- 翻转提示 -->
  <view class="flip-hint" wx:if="{{!loading && currentCard && !isFlipped}}">
    <text>点击卡片查看答案</text>
  </view>
  <!-- 纠错按钮 -->
  <view class="report-btn-wrapper" wx:if="{{!loading && currentCard}}">
    <view class="report-btn" bindtap="openReportModal">
      <text>🚨 内容有误？点击反馈</text>
    </view>
  </view>
  <!-- 加载状态 -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">加载卡片中...</text>
  </view>
  <!-- 完成状态 -->
  <view class="complete-state" wx:if="{{!loading && completed}}">
    <view class="complete-icon">🎊</view>
    <text class="complete-title">太棒了!</text>
    <text class="complete-desc">本次复习已完成</text>
    <view class="complete-stats">
      <text>复习了 {{cards.length}} 张卡片</text>
    </view>
    <button class="back-btn" bindtap="goBack">返回课程</button>
  </view>
  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && !completed && cards.length === 0}}">
    <text class="empty-text">暂无待复习的卡片</text>
    <button class="back-btn" bindtap="goBack">返回课程</button>
  </view>
  <!-- 纠错弹窗 -->
  <report-issue visible="{{showReportModal}}" courseKey="{{courseKey}}" cardId="{{currentCard.id}}" bind:close="closeReportModal" bind:success="onReportSuccess" />
</view>