<!-- pages/session-complete/index.wxml -->
<view class="page">
  <view class="celebration-area">
    <image class="celebration-icon" src="/images/icons/review/celebration.svg" mode="aspectFit" />
    <view class="celebration-title">本次完成总结</view>
    <view class="celebration-subtitle">做得不错，继续保持</view>
  </view>

  <canvas type="2d" id="confetti" class="confetti-canvas"></canvas>

  <card-flat>
    <view class="stats-title">学习数据</view>
    <view class="stat-grid">
      <view class="stat-item">
        <text class="stat-label">完成量</text>
        <text class="stat-value">{{count}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">正确率</text>
        <text class="stat-value">{{mode === 'quiz' ? accuracy + '%' : '--'}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">耗时</text>
        <text class="stat-value">{{durationText}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">明日预计</text>
        <text class="stat-value">{{nextDueText}}</text>
      </view>
    </view>
    <view class="stat-row" wx:if="{{starredCount > 0}}">
      <pill-tag variant="neutral" size="sm">星标收藏</pill-tag>
      <text class="stat-value">{{starredCount}} 张</text>
    </view>
    <view class="stat-row" wx:if="{{mode === 'quiz'}}">
      <pill-tag variant="neutral" size="sm">错题数</pill-tag>
      <text class="stat-value">{{wrongCount}} 题</text>
    </view>
  </card-flat>

  <card-flat wx:if="{{!loading}}">
    <image class="streak-flame" src="/images/icons/review/flame.svg" mode="aspectFit" />
    <view class="streak-info">
      <view class="streak-current">
        <text class="streak-number">{{currentStreak}}</text>
        <text class="streak-unit">天连续学习</text>
      </view>
      <view class="streak-best" wx:if="{{bestStreak > 0}}">历史最佳 {{bestStreak}} 天</view>
    </view>
  </card-flat>
  <view class="shortcut-actions" wx:if="{{wrongCount > 0}}">
    <juicy-button type="outline" full bind:tap="startWrongQuiz">错题强化</juicy-button>
  </view>
  <view class="action-area">
    <juicy-button type="primary" full disabled="{{actionLoading}}" bind:tap="continueReview">再来一组</juicy-button>
    <juicy-button type="secondary" full disabled="{{actionLoading}}" bind:tap="goHome">回到首页</juicy-button>
    <juicy-button
      type="secondary"
      full
      disabled="{{reminderStatus === 'ACCEPT' || reminderStatus === 'ACTIVE' || subscribeLoading}}"
      bind:tap="onSubscribeReminder"
    >
      {{reminderStatus === 'ACCEPT' || reminderStatus === 'ACTIVE' ? '已订阅下次提醒' : '订阅下次提醒'}}
    </juicy-button>
    <text class="subscribe-tip">订阅一次收到一次，可在我的里管理</text>
  </view>
</view>
