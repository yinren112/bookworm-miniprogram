<!-- subpackages/review/pages/leaderboard/index.wxml -->
<!-- å‘¨æ¦œé¡µé¢ -->

<view class="container">
  <!-- æˆ‘çš„ä¿¡æ¯å¡ç‰‡ -->
  <view class="my-card clay-card" wx:if="{{!loading && myStreak}}">
    <view class="my-header">
      <view class="my-rank" wx:if="{{myRank}}">
        <text class="rank-number">{{myRank}}</text>
        <text class="rank-label">æˆ‘çš„æ’å</text>
      </view>
      <view class="my-rank no-rank" wx:else>
        <text class="rank-number">-</text>
        <text class="rank-label">æš‚æ— æ’å</text>
      </view>
      <view class="my-stats">
        <view class="stat-item">
          <text class="stat-value">{{myStreak.weeklyPoints}}</text>
          <text class="stat-label">æœ¬å‘¨ç§¯åˆ†</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value fire">{{myStreak.currentStreak}}</text>
          <text class="stat-label">è¿ç»­å¤©æ•°</text>
        </view>
      </view>
    </view>
    <view class="my-tip" wx:if="{{!myStreak.isStudiedToday}}">
      <text>ä»Šå¤©è¿˜æ²¡å­¦ä¹ ï¼Œå¿«å»æ‰“å¡å§</text>
    </view>
    <view class="my-tip studied" wx:else>
      <text>ä»Šæ—¥å·²å­¦ä¹ ï¼Œç»§ç»­ä¿æŒ</text>
    </view>
  </view>

  <!-- æ¦œå•æ ‡é¢˜ -->
  <view class="list-header" wx:if="{{!loading}}">
    <text class="list-title">æœ¬å‘¨å­¦ä¹ æ¦œ</text>
    <text class="list-subtitle">æ¯å‘¨ä¸€ 00:00 é‡ç½®</text>
  </view>

  <!-- æ¦œå•åˆ—è¡¨ -->
  <view class="leaderboard-list" wx:if="{{!loading && items.length > 0}}">
    <view
      class="rank-item {{index < 3 ? 'top-three' : ''}} {{item.userId === myStreak.userId ? 'is-me' : ''}}"
      wx:for="{{items}}"
      wx:key="userId"
    >
      <!-- æ’å -->
      <view class="item-rank">
        <view class="rank-badge rank-{{index + 1}}" wx:if="{{index < 3}}">
          <text>{{index === 0 ? 'ğŸ¥‡' : (index === 1 ? 'ğŸ¥ˆ' : 'ğŸ¥‰')}}</text>
        </view>
        <text class="rank-text" wx:else>{{item.rank}}</text>
      </view>

      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="item-user">
        <image
          class="user-avatar"
          src="{{item.avatarUrl || '/images/default-avatar.png'}}"
          mode="aspectFill"
        />
        <text class="user-name">{{item.nickname}}</text>
      </view>

      <!-- æ•°æ® -->
      <view class="item-stats">
        <view class="points">
          <text class="points-value">{{item.weeklyPoints}}</text>
          <text class="points-label">ç§¯åˆ†</text>
        </view>
        <view class="streak" wx:if="{{item.currentStreak > 0}}">
          <text class="streak-icon">ğŸ”¥</text>
          <text class="streak-value">{{item.currentStreak}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && items.length === 0}}">
    <view class="empty-icon">ğŸ“Š</view>
    <text class="empty-text">æœ¬å‘¨æš‚æ— å­¦ä¹ æ•°æ®</text>
    <text class="empty-hint">å¿«å»å­¦ä¹ ï¼Œæˆä¸ºç¬¬ä¸€åå§</text>
    <button class="start-btn" bindtap="goBack">å¼€å§‹å­¦ä¹ </button>
  </view>

  <!-- åº•éƒ¨æç¤º -->
  <view class="footer-tip" wx:if="{{!loading && items.length > 0}}">
    <text>æ¯å®Œæˆä¸€é“é¢˜ç›®æˆ–å¡ç‰‡ +1 ç§¯åˆ†</text>
  </view>
</view>
