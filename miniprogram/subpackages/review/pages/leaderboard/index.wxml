<!-- subpackages/review/pages/leaderboard/index.wxml -->
<!-- 周榜页面 -->
<view class="container">
  <loading-state wx:if="{{loading}}" variant="page" text="正在加载排行榜..." />
  <error-state wx:elif="{{error}}" title="加载失败" desc="{{errorMsg || '请重试'}}" bind:retry="loadLeaderboard" />
  <card-flat wx:if="{{!loading && !error && myStreak}}" custom-class="anim-pop">
    <view class="my-head">
      <pill-tag variant="neutral" size="sm">我的排名 {{myRank || '-'}}</pill-tag>
      <pill-tag variant="{{myStreak.isStudiedToday ? 'green' : 'red'}}" size="sm">{{myStreak.isStudiedToday ? '今日已打卡' : '今日未学习'}}</pill-tag>
    </view>
    <view class="my-stats">
      <stat-split
        leftValue="{{myStreak.weeklyPoints}}"
        leftLabel="本周积分"
        leftTone="blue"
        rightValue="{{myStreak.currentStreak}}"
        rightLabel="连续天数"
        rightTone="yellow"
      />
    </view>
  </card-flat>
  <view class="list-header" wx:if="{{!loading && !error}}">
    <text class="list-title">本周学霸榜</text>
    <text class="list-subtitle">每周一 00:00 重置</text>
  </view>
  <view class="leaderboard-list" wx:if="{{!loading && !error && items.length > 0}}">
    <card-flat
      wx:for="{{items}}"
      wx:key="userId"
      custom-class="rank-item anim-pop {{item.userId === myStreak.userId ? 'is-me' : ''}}"
      style="--anim-delay: {{index * 40}}ms;"
    >
      <view class="rank-row">
        <pill-tag variant="{{index < 3 ? 'yellow' : 'neutral'}}" size="sm">{{item.rank}}</pill-tag>
        <view class="user">
          <image class="user-avatar" src="{{item.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill" />
          <text class="user-name">{{item.nickname}}</text>
        </view>
        <view class="stats">
          <pill-tag variant="blue" size="sm">{{item.weeklyPoints}} 积分</pill-tag>
          <pill-tag wx:if="{{item.currentStreak > 0}}" variant="yellow" size="sm">{{item.currentStreak}} 天</pill-tag>
        </view>
      </view>
    </card-flat>
  </view>

  <empty-state
    title="本周还没人上榜"
    desc="先完成一轮练习"
    actionText="开始学习"
    actionType="primary"
    showAction
    bind:action="goBack"
    wx:if="{{!loading && !error && items.length === 0}}"
  />

  <view class="footer-tip" wx:if="{{!loading && !error && items.length > 0}}">
    <text>每完成一道题目或卡片 +1 积分</text>
  </view>
</view>
