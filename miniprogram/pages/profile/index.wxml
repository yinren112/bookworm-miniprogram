<!-- pages/profile/index.wxml -->
<view class="container profile-container">
  <!-- Header Section (User Card) -->
  <view class="header">
    <view class="avatar-wrapper">
      <image class="user-avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
      <!-- 微信头像组件 (OpenData) 已废弃，建议使用 button open-type="chooseAvatar" 或者直接显示默认头像引导用户完善 -->
      <!-- 这里我们先用精致的默认头像 -->
    </view>
    <text class="username">{{userInfo.nickName || '微信用户'}}</text>
    <!-- Phone Number Authorization Button -->
    <button wx:if="{{!isReviewMode && !hasPhoneNumber}}" class="auth-phone-button" open-type="getPhoneNumber" bindgetphonenumber="onGetPhoneNumber">
      授权手机号（关联卖书记录）
    </button>
  </view>
  <!-- Review System Entry -->
  <view class="review-entry-card card" bindtap="goToReview">
    <view class="review-entry-content">
      <view class="review-icon-wrapper">
        <text class="review-icon">📚</text>
      </view>
      <view class="review-text-wrapper">
        <text class="review-title">复习助手</text>
        <text class="review-desc">背卡片、练习题、查资料</text>
      </view>
    </view>
    <image class="menu-arrow" src="/images/icons/arrow-right.svg" />
  </view>
  <!-- Staff Operations Section - Only visible for STAFF role -->
  <view wx:if="{{!isReviewMode && userInfo.role === 'STAFF'}}" class="staff-section menu-card card">
    <view class="section-title">
      <text class="title-text">员工操作</text>
      <view class="staff-badge">STAFF</view>
    </view>
    <navigator url="/pages/acquisition-scan/index" class="menu-item" hover-class="item-hover">
      <view class="menu-content">
        <text class="icon-text">📷</text>
        <text class="menu-text">按本收购</text>
      </view>
      <image class="menu-arrow" src="/images/icons/arrow-right.svg" />
    </navigator>
  </view>
  <view class="menu-card card">
    <view class="menu-item" bindtap="copyWechatId" hover-class="item-hover">
      <text class="menu-text">联系客服</text>
      <image class="menu-arrow" src="/images/icons/arrow-right.svg" />
    </view>
    <button class="menu-item share-button" open-type="share" hover-class="item-hover">
      <text class="menu-text">分享给好友</text>
      <image class="menu-arrow" src="/images/icons/arrow-right.svg" />
    </button>
    <view class="menu-item" bindtap="showTerms" hover-class="item-hover">
      <text class="menu-text">用户服务协议</text>
      <image class="menu-arrow" src="/images/icons/arrow-right.svg" />
    </view>
    <view class="menu-item" bindtap="showPrivacy" hover-class="item-hover">
      <text class="menu-text">隐私政策</text>
      <image class="menu-arrow" src="/images/icons/arrow-right.svg" />
    </view>
    <view class="menu-item" bindtap="goToCustomerService" hover-class="item-hover">
      <text class="menu-text">联系客服与帮助</text>
      <image class="menu-arrow" src="/images/icons/arrow-right.svg" />
    </view>
  </view>
  <view class="support-info">
    <text>客服微信: {{serviceInfo.wechatId}} (点击复制)</text>
    <text>服务时间: {{serviceInfo.time}}</text>
  </view>
</view>