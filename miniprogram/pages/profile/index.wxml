<!-- pages/profile/index.wxml -->
<view class="container profile-container">
  <view class="header">
    <view class="avatar-wrapper">
      <open-data type="userAvatarUrl"></open-data>
    </view>
    <text class="username">用户名</text>
    <text class="nickname">{{userInfo.nickName}}</text>

    <!-- Phone Number Authorization Button -->
    <button
      wx:if="{{!hasPhoneNumber}}"
      class="auth-phone-button"
      open-type="getPhoneNumber"
      bindgetphonenumber="onGetPhoneNumber"
    >
      授权手机号（关联卖书记录）
    </button>

    <!-- Development Mode: Manual Phone Input (Remove in production) -->
    <button
      wx:if="{{!hasPhoneNumber}}"
      class="auth-phone-button-dev"
      bindtap="onManualPhoneInput"
    >
      [开发测试] 手动输入手机号
    </button>

    <!-- DEBUG: Display user role -->
    <view style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 8px;">
      <text style="color: #ff0000; font-size: 14px;">Debug: User Role is [{{userInfo.role}}]</text>
    </view>
  </view>

  <!-- Staff Operations Section - Only visible for STAFF role -->
  <view wx:if="{{userInfo.role === 'STAFF'}}" class="staff-section menu-card card">
    <view class="section-title">
      <text class="title-text">员工操作</text>
      <view class="staff-badge">STAFF</view>
    </view>
    <navigator url="/pages/acquisition-scan/index" class="menu-item" hover-class="item-hover">
      <view class="menu-content">
        <text class="icon-text">📷</text>
        <text class="menu-text">按本收购</text>
      </view>
      <image class="menu-arrow" src="/images/icons/arrow-right.svg" />
    </navigator>
  </view>

  <view class="menu-card card">
    <view class="menu-item" bindtap="copyWechatId" hover-class="item-hover">
      <text class="menu-text">联系客服</text>
      <image class="menu-arrow" src="/images/icons/arrow-right.svg" />
    </view>
    <button class="menu-item share-button" open-type="share" hover-class="item-hover">
      <text class="menu-text">分享给好友</text>
      <image class="menu-arrow" src="/images/icons/arrow-right.svg" />
    </button>
    <view class="menu-item" bindtap="showTerms" hover-class="item-hover">
      <text class="menu-text">用户服务协议</text>
      <image class="menu-arrow" src="/images/icons/arrow-right.svg" />
    </view>
    <view class="menu-item" bindtap="showPrivacy" hover-class="item-hover">
      <text class="menu-text">隐私政策</text>
      <image class="menu-arrow" src="/images/icons/arrow-right.svg" />
    </view>
    <view class="menu-item" bindtap="goToCustomerService" hover-class="item-hover">
      <text class="menu-text">联系客服与帮助</text>
      <image class="menu-arrow" src="/images/icons/arrow-right.svg" />
    </view>
  </view>

  <view class="support-info">
    <text>客服微信: {{serviceInfo.wechatId}} (点击复制)</text>
    <text>服务时间: {{serviceInfo.time}}</text>
  </view>
</view>