<!-- pages/acquisition-scan/index.wxml -->
<wxs module="filters" src="../../utils/filters.wxs"></wxs>
<view class="container">
  <view class="header">
    <text class="header-title">æ‰«ç æ”¶è´­ä¹¦ç±</text>
    <text class="header-subtitle">æ‰«æISBNæ¡ç ä»¥æ·»åŠ ä¹¦ç±</text>
  </view>

  <!-- æ‰«ç æŒ‰é’® -->
  <button class="scan-button" bindtap="onScanCode">
    <text class="scan-icon">ğŸ“·</text>
    <text class="scan-text">æ‰«æISBNæ¡ç </text>
  </button>

  <!-- å·²æ‰«æä¹¦ç±åˆ—è¡¨ -->
  <view wx:if="{{scannedItems.length > 0}}" class="scanned-list">
    <view class="list-header">
      <text class="list-title">å·²æ‰«æä¹¦ç± ({{scannedItems.length}})</text>
    </view>

    <view class="book-item {{item.status === 'acquirable' ? 'acquirable' : 'rejected'}}"
          wx:for="{{scannedItems}}"
          wx:key="index">
      <view class="book-info">
        <view class="book-header">
          <text class="book-title">{{item.skuInfo ? item.skuInfo.title : item.isbn}}</text>
          <view class="status-badge {{item.status}}">
            {{item.status === 'acquirable' ? 'å¯æ”¶è´­' : 'ä¸æ”¶è´­'}}
          </view>
        </view>

        <text wx:if="{{item.skuInfo}}" class="book-author">{{item.skuInfo.author || 'ä½œè€…æœªçŸ¥'}}</text>
        <text wx:if="{{item.skuInfo}}" class="book-edition">ç‰ˆæœ¬: {{item.skuInfo.edition || 'æœªçŸ¥'}}</text>


        <text wx:if="{{item.status === 'rejected'}}" class="rejection-reason">æ­¤ä¹¦ç±ä¸åœ¨æ”¶è´­ç™½åå•ä¸­</text>
      </view>

      <view class="book-actions">
        <button class="remove-button" data-index="{{index}}" bindtap="onRemoveItem">ç§»é™¤</button>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{scannedItems.length === 0}}" class="empty-state">
    <text class="empty-icon">ğŸ“š</text>
    <text class="empty-text">è¿˜æ²¡æœ‰æ‰«æä»»ä½•ä¹¦ç±</text>
    <text class="empty-hint">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æ‰«ç </text>
  </view>

  <!-- ç»“ç®—ä¿¡æ¯ -->
  <view wx:if="{{summary.count > 0}}" class="summary-section">
    <view class="summary-row">
      <text class="summary-label">å¯æ”¶è´­æ•°é‡:</text>
      <text class="summary-value">{{summary.count}} æœ¬</text>
    </view>

    <!-- é¡¾å®¢æ‰‹æœºå· -->
    <view class="input-row">
      <text class="input-label">é¡¾å®¢æ‰‹æœºå·:</text>
      <input
        class="text-input"
        type="number"
        value="{{customerPhone}}"
        bindinput="onPhoneInput"
        placeholder="è¯·è¾“å…¥æ‰‹æœºå·"
        maxlength="11" />
    </view>

    <!-- æ€»é‡é‡ -->
    <view class="input-row">
      <text class="input-label">æ€»é‡é‡ (kg):</text>
      <input
        class="number-input"
        type="digit"
        value="{{totalWeight}}"
        bindinput="onWeightInput"
        placeholder="0.00" />
    </view>

    <!-- å•ä»· -->
    <view class="input-row">
      <text class="input-label">å•ä»· (å…ƒ/kg):</text>
      <input
        class="number-input"
        type="digit"
        value="{{unitPriceYuan}}"
        bindinput="onUnitPriceInput"
        placeholder="0.00" />
    </view>

    <!-- æœ€ç»ˆæ€»é‡‘é¢ -->
    <view class="summary-row total">
      <text class="summary-label">æœ€ç»ˆæ€»é‡‘é¢:</text>
      <text class="summary-value highlight">{{filters.formatCurrency(finalAmount)}}</text>
    </view>
  </view>

  <!-- æäº¤æŒ‰é’® -->
  <view wx:if="{{summary.count > 0}}" class="submit-section">
    <button class="submit-button" bindtap="onSubmit" disabled="{{submitting}}">
      {{submitting ? 'æäº¤ä¸­...' : 'ç¡®è®¤æ”¶è´­'}}
    </button>
  </view>
</view>
