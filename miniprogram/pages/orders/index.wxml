<!-- pages/orders/index.wxml -->
<wxs src="../../utils/formatter.wxs" module="tools" />

<view class="container">
  <view class="header-title">我的订单</view>

  <skeleton wx:if="{{state.status === 'loading'}}" type="list" count="3" />
  <view wx:if="{{state.status === 'error'}}" class="error-message">{{state.error}}</view>
  <view wx:if="{{state.status === 'success' && state.data.length === 0}}" class="empty-state">
    <text>你还没有任何订单</text>
  </view>

  <view class="order-list" wx:if="{{state.status === 'success' && state.data.length > 0}}">
    <view class="order-card" wx:for="{{state.data}}" wx:key="id" bind:tap="navigateToDetail" data-order-id="{{item.id}}" hover-class="item-hover">
      <view class="order-header">
        <view class="status-tag {{item.status === 'COMPLETED' ? 'success' : item.status === 'PENDING_PAYMENT' ? 'error' : 'warning'}}">{{statusMap[item.status] || '未知状态'}}</view>
        <view class="order-date">{{tools.formatOrderTime(item.createdAt)}}</view>
      </view>
      
      <view class="order-content">
        <view class="book-summary">
          <text class="first-book">{{item.orderItem[0].inventoryItem.bookSku.bookMaster.title}}</text>
          <text wx:if="{{item.orderItem.length > 1}}" class="more-books"> 等{{item.orderItem.length}}件商品</text>
        </view>
        <view class="order-total">¥{{item.total_amount}}</view>
      </view>
    </view>
  </view>
</view>